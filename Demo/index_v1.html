<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能提示词工作台 - AI多平台协作系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .category-gradient-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .category-gradient-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .category-gradient-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .category-gradient-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .category-gradient-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .category-gradient-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .category-gradient-7 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .category-gradient-8 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        .method-card { transition: all 0.3s ease; }
        .method-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .level-badge { 
            font-size: 0.75rem; 
            padding: 2px 8px; 
            border-radius: 12px; 
            font-weight: 500;
        }
        .level-basic { background-color: #10b981; color: white; }
        .level-advanced { background-color: #f59e0b; color: white; }
        .level-expert { background-color: #ef4444; color: white; }
        
        /* 进度条样式 */
        .progress-container {
            position: relative;
            background: #f0f0f0;
            border-radius: 25px;
            padding: 3px;
            margin: 1rem 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .progress-bar {
            display: flex;
            align-items: center;
            height: 30px;
            border-radius: 22px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-normal { background: linear-gradient(45deg, #4CAF50, #8BC34A); }
        .progress-warning { background: linear-gradient(45deg, #FF9800, #FFC107); }
        .progress-error { background: linear-gradient(45deg, #F44336, #E91E63); }
        .progress-complete { background: linear-gradient(45deg, #2196F3, #00BCD4); }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-weight: bold;
            color: #333;
            font-size: 12px;
            z-index: 10;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulsing { animation: pulse 1.5s infinite; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">🎯</span>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">提示词操作方法完整分类体系</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">MECE终极版 - 8大维度完全穷尽</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden sm:flex items-center space-x-2 text-xs">
                        <span class="level-badge level-basic">🟢 基础层</span>
                        <span class="level-badge level-advanced">🟡 进阶层</span>
                        <span class="level-badge level-expert">🔴 高级层</span>
                    </div>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="searchInput"
                            placeholder="搜索方法..." 
                            class="w-64 px-4 py-2 pl-10 text-base bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white"
                        >
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- 侧边栏分类 -->
            <div class="lg:w-1/4">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 sticky top-8">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">八大操作分类</h2>
                    <nav class="space-y-2" id="categoryNav">
                        <!-- 分类导航将由JavaScript生成 -->
                    </nav>
                    <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <h3 class="text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2">💡 使用提示</h3>
                        <ul class="text-xs text-blue-800 dark:text-blue-200 space-y-1">
                            <li>• 单一操作：针对特定问题</li>
                            <li>• 组合操作：跨类别组合</li>
                            <li>• 渐进提升：循序渐进</li>
                            <li>• 情境适配：场景选择</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4 space-y-3">
                        <button onclick="showAIModelSelector()" class="w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-200 flex items-center justify-center">
                            <span class="mr-2">🎛️</span>
                            AI模型选择器
                        </button>
                        <button onclick="showAnalyzer()" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-medium hover:from-purple-600 hover:to-pink-600 transition-all duration-200 flex items-center justify-center">
                            <span class="mr-2">🔍</span>
                            提示词配方解析器
                        </button>
                        <button onclick="showSmartHelper()" class="w-full px-4 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg font-medium hover:from-green-600 hover:to-blue-600 transition-all duration-200 flex items-center justify-center">
                            <span class="mr-2">🚀</span>
                            智能提示词助手
                        </button>
                        <button onclick="showTrinityGenerator()" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 text-white rounded-lg font-medium hover:from-purple-600 hover:via-pink-600 hover:to-orange-600 transition-all duration-200 flex items-center justify-center">
                            <span class="mr-2">🧠</span>
                            三维思维生成器
                        </button>
                    </div>
                </div>
            </div>
            <!-- 主内容区 -->
            <div class="lg:w-3/4">
                <!-- 分类介绍 -->
                <div id="categoryIntro" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
                    <!-- 内容由JavaScript动态生成 -->
                </div>
                <!-- 方法列表 -->
                <div id="methodsList" class="space-y-4">
                    <!-- 方法卡片由JavaScript动态生成 -->
                </div>
                <!-- 方法详情模态框 -->
                <div id="methodModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 id="modalTitle" class="text-2xl font-bold text-gray-900 dark:text-white"></h3>
                                    <p id="modalCategory" class="text-sm text-gray-500 dark:text-gray-400"></p>
                                </div>
                                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="modalContent">
                                <!-- 详细内容由JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 智能提示词助手模态框 -->
                <div id="smartHelperModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                                        <span class="mr-3">🚀</span>
                                        智能提示词助手
                                    </h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">让AI更懂你 - 3分钟上手，够用就好，快速迭代</p>
                                </div>
                                <button onclick="closeSmartHelper()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- 30秒快速开始 -->
                            <div class="mb-8">
                                <div class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                        <span class="mr-2">⚡</span>
                                        30秒快速开始
                                    </h4>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                        <button onclick="selectMode('simple')" id="simpleMode" class="mode-button p-4 bg-white dark:bg-gray-700 rounded-lg border-2 border-transparent hover:border-green-400 transition-all duration-200">
                                            <div class="text-center">
                                                <div class="text-2xl mb-2">📝</div>
                                                <div class="font-medium text-gray-900 dark:text-white">简单模式</div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">日常对话、基础任务</div>
                                                <div class="text-xs text-green-600 dark:text-green-400 mt-1">推荐新手</div>
                                            </div>
                                        </button>
                                        
                                        <button onclick="selectMode('professional')" id="professionalMode" class="mode-button p-4 bg-white dark:bg-gray-700 rounded-lg border-2 border-transparent hover:border-blue-400 transition-all duration-200">
                                            <div class="text-center">
                                                <div class="text-2xl mb-2">💼</div>
                                                <div class="font-medium text-gray-900 dark:text-white">专业模式</div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">工作场景、复杂需求</div>
                                                <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">推荐熟手</div>
                                            </div>
                                        </button>
                                        
                                        <button onclick="selectMode('smart')" id="smartMode" class="mode-button p-4 bg-white dark:bg-gray-700 rounded-lg border-2 border-transparent hover:border-purple-400 transition-all duration-200">
                                            <div class="text-center">
                                                <div class="text-2xl mb-2">🤖</div>
                                                <div class="font-medium text-gray-900 dark:text-white">智能模式</div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">我帮你选</div>
                                                <div class="text-xs text-purple-600 dark:text-purple-400 mt-1">推荐懒人</div>
                                            </div>
                                        </button>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <span class="mr-2">💬</span>
                                            <span class="font-medium text-gray-900 dark:text-white">或者直接说出你的需求：</span>
                                        </div>
                                        <div class="flex space-x-2">
                                            <input type="text" id="quickInput" placeholder="我想要_____________________" 
                                                   class="flex-1 px-4 py-2 text-base bg-gray-50 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-gray-900 dark:text-white">
                                            <button onclick="generateQuickPrompt()" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all duration-200 font-medium">
                                                一键生成
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 模式详情区域 -->
                            <div id="modeDetails" class="space-y-6 hidden">
                                <!-- 内容将由JavaScript动态生成 -->
                            </div>
                            
                            <!-- 防坑指南 -->
                            <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-6 mb-6">
                                <h4 class="font-semibold text-red-900 dark:text-red-300 mb-4 flex items-center">
                                    <span class="mr-2">⚠️</span>
                                    防坑指南 - 避免常见错误
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h5 class="font-medium text-red-800 dark:text-red-300 mb-2">❌ 常见错误</h5>
                                        <ul class="text-sm text-red-700 dark:text-red-200 space-y-1">
                                            <li>• <strong>过度复杂</strong>："请用辩证唯物主义哲学观点分析..." → 太装了</li>
                                            <li>• <strong>模糊不清</strong>："帮我写个东西" → AI也猜不到</li>
                                            <li>• <strong>自相矛盾</strong>："详细但要简短" → 选一个</li>
                                            <li>• <strong>贪多求全</strong>："帮我写文章+翻译+配图+..." → 一次一个任务</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-green-800 dark:text-green-300 mb-2">✅ 正确做法</h5>
                                        <ul class="text-sm text-green-700 dark:text-green-200 space-y-1">
                                            <li>• <strong>说人话</strong>：怎么和同事说就怎么写</li>
                                            <li>• <strong>一次一事</strong>：复杂任务分步骤来</li>
                                            <li>• <strong>给例子</strong>：不确定就给个示例</li>
                                            <li>• <strong>快速迭代</strong>：不满意就让AI改</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 记住这三句话 -->
                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6">
                                <h4 class="font-semibold text-yellow-900 dark:text-yellow-300 mb-4 flex items-center">
                                    <span class="mr-2">💡</span>
                                    记住这三句话
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center p-4 bg-white dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl mb-2">🎯</div>
                                        <div class="font-medium text-gray-900 dark:text-white mb-2">够用就好</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">不是越复杂越好，适合的才是最好的</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl mb-2">🔄</div>
                                        <div class="font-medium text-gray-900 dark:text-white mb-2">快速迭代</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">第一次不完美很正常，调整一下就好</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl mb-2">💭</div>
                                        <div class="font-medium text-gray-900 dark:text-white mb-2">相信直觉</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">如果感觉太复杂，那就是真的太复杂了</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 三维思维生成器模态框 -->
                <div id="trinityModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                                        <span class="mr-3">🧠</span>
                                        三维思维生成器
                                    </h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">多角度协作思维，让AI从结构化、解构性、整合性三个维度深度思考</p>
                                </div>
                                <button onclick="closeTrinityGenerator()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- 三维思维介绍 -->
                            <div class="bg-gradient-to-r from-purple-50 via-pink-50 to-orange-50 dark:from-purple-900/20 dark:via-pink-900/20 dark:to-orange-900/20 rounded-lg p-6 mb-8">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                    <span class="mr-2">🎯</span>
                                    三维思维协作系统
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center p-4 bg-white dark:bg-gray-700 rounded-lg">
                                        <div class="text-3xl mb-2">🏗️</div>
                                        <div class="font-medium text-purple-600 dark:text-purple-400 mb-2">结构思维</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">逻辑结构化，系统性分析，层级化组织</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-700 rounded-lg">
                                        <div class="text-3xl mb-2">💥</div>
                                        <div class="font-medium text-pink-600 dark:text-pink-400 mb-2">解构思维</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">打破常规，反向思考，创新突破</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-700 rounded-lg">
                                        <div class="text-3xl mb-2">🔗</div>
                                        <div class="font-medium text-orange-600 dark:text-orange-400 mb-2">整合思维</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">融合表达，平衡协调，清晰呈现</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 任务输入区 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <div class="space-y-6">
                                    <div class="bg-white dark:bg-gray-700 rounded-lg p-6 border border-gray-200 dark:border-gray-600">
                                        <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span class="mr-2">📝</span>
                                            输入你的任务需求
                                        </h4>
                                        <textarea 
                                            id="trinityTaskInput" 
                                            placeholder="描述你想完成的任务，例如：
• 制定新产品的营销策略
• 分析用户流失问题的解决方案
• 设计团队协作流程
• 重新定义品牌价值主张
系统会自动从三个思维维度进行协作分析..."
                                            class="w-full h-40 p-4 text-base bg-gray-50 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white resize-none"
                                        ></textarea>
                                        
                                        <div class="mt-4">
                                            <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">任务属性标签</h5>
                                            <div class="flex flex-wrap gap-2">
                                                <button onclick="toggleTaskTag('creative')" id="tag-creative" class="task-tag px-3 py-1 text-sm bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full hover:bg-purple-100 dark:hover:bg-purple-800 transition-all duration-200">🎨 创新类</button>
                                                <button onclick="toggleTaskTag('analytical')" id="tag-analytical" class="task-tag px-3 py-1 text-sm bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full hover:bg-purple-100 dark:hover:bg-purple-800 transition-all duration-200">📊 分析类</button>
                                                <button onclick="toggleTaskTag('strategic')" id="tag-strategic" class="task-tag px-3 py-1 text-sm bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full hover:bg-purple-100 dark:hover:bg-purple-800 transition-all duration-200">🎯 战略类</button>
                                                <button onclick="toggleTaskTag('complex')" id="tag-complex" class="task-tag px-3 py-1 text-sm bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full hover:bg-purple-100 dark:hover:bg-purple-800 transition-all duration-200">🔄 复杂类</button>
                                            </div>
                                        </div>
                                        
                                        <button onclick="startTrinityGeneration()" class="mt-6 w-full px-6 py-3 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 text-white rounded-lg font-medium hover:from-purple-600 hover:via-pink-600 hover:to-orange-600 transition-all duration-200">
                                            🚀 启动三维思维协作
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="space-y-6">
                                    <div class="bg-white dark:bg-gray-700 rounded-lg p-6 border border-gray-200 dark:border-gray-600">
                                        <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span class="mr-2">⚙️</span>
                                            智能调度配置
                                        </h4>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">思维模式权重分配</label>
                                                <div class="space-y-3">
                                                    <div class="flex items-center justify-between">
                                                        <span class="text-sm text-gray-600 dark:text-gray-400">🏗️ 结构思维</span>
                                                        <input type="range" id="structureWeight" min="0" max="100" value="33" class="w-24" onchange="updateWeights()">
                                                        <span class="text-sm font-medium text-gray-900 dark:text-white w-12" id="structureValue">33%</span>
                                                    </div>
                                                    <div class="flex items-center justify-between">
                                                        <span class="text-sm text-gray-600 dark:text-gray-400">💥 解构思维</span>
                                                        <input type="range" id="deconstructWeight" min="0" max="100" value="33" class="w-24" onchange="updateWeights()">
                                                        <span class="text-sm font-medium text-gray-900 dark:text-white w-12" id="deconstructValue">33%</span>
                                                    </div>
                                                    <div class="flex items-center justify-between">
                                                        <span class="text-sm text-gray-600 dark:text-gray-400">🔗 整合思维</span>
                                                        <input type="range" id="integrateWeight" min="0" max="100" value="34" class="w-24" onchange="updateWeights()">
                                                        <span class="text-sm font-medium text-gray-900 dark:text-white w-12" id="integrateValue">34%</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">协作模式</label>
                                                <select id="collaborationMode" class="w-full p-2 text-sm bg-gray-50 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded text-gray-900 dark:text-white">
                                                    <option value="sequential">🔄 顺序协作（结构→解构→整合）</option>
                                                    <option value="parallel">⚡ 并行协作（三维同时思考）</option>
                                                    <option value="iterative">🔁 迭代协作（循环优化）</option>
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">输出深度</label>
                                                <select id="outputDepth" class="w-full p-2 text-sm bg-gray-50 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded text-gray-900 dark:text-white">
                                                    <option value="outline">📋 框架概要</option>
                                                    <option value="detailed">📝 详细分析</option>
                                                    <option value="comprehensive">📚 全面深入</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 三维思维协作过程展示 -->
                            <div id="trinityProcess" class="space-y-6 hidden">
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6">
                                    <h4 class="font-semibold text-blue-900 dark:text-blue-300 mb-4 flex items-center">
                                        <span class="mr-2">🔄</span>
                                        三维思维协作过程
                                    </h4>
                                    <div id="processSteps" class="space-y-4">
                                        <!-- 动态生成协作步骤 -->
                                    </div>
                                </div>
                                
                                <!-- 最终生成的提示词 -->
                                <div id="finalPrompt" class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg p-6 hidden">
                                    <h4 class="font-semibold text-green-900 dark:text-green-300 mb-4 flex items-center">
                                        <span class="mr-2">✨</span>
                                        三维协作生成的提示词
                                    </h4>
                                    <div id="generatedPrompt" class="bg-white dark:bg-gray-800 rounded-lg p-4 border">
                                        <!-- 生成的提示词内容 -->
                                    </div>
                                    <div class="flex justify-center space-x-4 mt-6">
                                        <button onclick="copyTrinityPrompt()" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all duration-200">
                                            📋 复制提示词
                                        </button>
                                        <button onclick="optimizeTrinityPrompt()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200">
                                            🔄 重新协作
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 提示词配方解析器模态框 -->
                <div id="analyzerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                                        <span class="mr-3">🔍</span>
                                        提示词配方解析器
                                    </h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">逆向工程优秀提示词，识别组合配方，启发举一反三</p>
                                </div>
                                <button onclick="closeAnalyzer()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- 左侧：输入区域 -->
                                <div class="space-y-6">
                                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-6">
                                        <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span class="mr-2">📝</span>
                                            输入待分析的提示词
                                        </h4>
                                        <textarea 
                                            id="promptInput" 
                                            placeholder="请输入您想分析的提示词，例如：
你是一位资深的产品经理，拥有10年的互联网产品经验。请为我们的在线教育平台分析用户流失问题。
要求：
1. 从用户体验、产品功能、竞争环境三个维度分析
2. 每个维度提供具体的数据支撑和案例
3. 输出格式：问题分析→原因挖掘→改进建议
4. 确保建议具有可操作性和优先级排序
请以SWOT分析框架为基础，同时考虑用户生命周期的不同阶段。"
                                            class="w-full h-64 p-4 text-base bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white resize-none"
                                        ></textarea>
                                        
                                        <div class="mt-4 flex justify-between items-center">
                                            <div class="flex space-x-2">
                                                <button onclick="loadExample(1)" class="px-3 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800/50">
                                                    🇨🇳 产品分析
                                                </button>
                                                <button onclick="loadExample(2)" class="px-3 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800/50">
                                                    🇺🇸 Marketing
                                                </button>
                                                <button onclick="loadExample(3)" class="px-3 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800/50">
                                                    🇯🇵 商品戦略
                                                </button>
                                            </div>
                                            <button onclick="analyzePrompt()" class="px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-medium hover:from-purple-600 hover:to-pink-600 transition-all duration-200">
                                                🔬 开始解析
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- 优化建议区域 -->
                                    <div id="optimizationSuggestions" class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 hidden">
                                        <h4 class="font-semibold text-blue-900 dark:text-blue-300 mb-4 flex items-center">
                                            <span class="mr-2">💡</span>
                                            智能优化建议
                                        </h4>
                                        <div id="suggestionContent">
                                            <!-- 建议内容由JavaScript生成 -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 右侧：分析结果 -->
                                <div class="space-y-6">
                                    <!-- 配方识别结果 -->
                                    <div id="analysisResult" class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6 hidden">
                                        <h4 class="font-semibold text-green-900 dark:text-green-300 mb-4 flex items-center">
                                            <span class="mr-2">🧬</span>
                                            配方成分识别
                                        </h4>
                                        <div id="ingredientsList">
                                            <!-- 成分列表由JavaScript生成 -->
                                        </div>
                                    </div>
                                    
                                    <!-- 效果预测 -->
                                    <div id="effectPrediction" class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6 hidden">
                                        <h4 class="font-semibold text-yellow-900 dark:text-yellow-300 mb-4 flex items-center">
                                            <span class="mr-2">📊</span>
                                            效果评估分析
                                        </h4>
                                        <div id="predictionContent">
                                            <!-- 效果分析内容由JavaScript生成 -->
                                        </div>
                                    </div>
                                    
                                    <!-- 举一反三建议 -->
                                    <div id="inspirationSuggestions" class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-6 hidden">
                                        <h4 class="font-semibold text-orange-900 dark:text-orange-300 mb-4 flex items-center">
                                            <span class="mr-2">🚀</span>
                                            举一反三启发
                                        </h4>
                                        <div id="inspirationContent">
                                            <!-- 启发内容由JavaScript生成 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // 提示词方法数据库（MECE终极版 + 新兴方法整合）
        const methodsDatabase = {
            "结构性操作": {
                icon: "🏗️",
                description: "改变提示词的组织架构和逻辑关系",
                level: "basic",
                gradient: "category-gradient-1",
                methods: {
                    "解构重组": {
                        "结构重构": {
                            description: "拆解复杂提示词并重新组装",
                            explanation: "就像拆积木重新搭建一样，把复杂的提示词拆开，按更清晰的逻辑重新组织。",
                            example: "原版：'写一篇关于AI的有趣文章给普通读者看，要包含技术原理'\n重构：'角色：科普作家 → 目标：普通读者 → 主题：AI技术 → 要求：通俗有趣 → 内容：原理+应用'"
                        },
                        "层级分解": {
                            description: "大任务分解为步骤序列",
                            explanation: "像剥洋葱一样，把大任务一层层分解成可执行的小步骤。",
                            example: "大任务：'制定营销策略'\n分解：'战略层面：确定目标市场 → 战术层面：选择推广渠道 → 行动层面：制定具体计划 → 执行层面：分配资源时间'"
                        },
                        "Chain-of-Thought升级版": {
                            description: "Tree/Graph/Table-of-Thought等多分支思考路径",
                            explanation: "不只是线性思考链，而是树状、图状、表格状的多维思考结构。",
                            example: "Tree-of-Thought：'从A角度分析→分支1：技术层面，分支2：商业层面，分支3：用户层面→每个分支再细分→最终汇总最优路径'"
                        },
                        "ReAct模式": {
                            description: "Reasoning + Action的结合提示，每轮思考后采取行动",
                            explanation: "像科学家做实验一样，思考→行动→观察→再思考→再行动。",
                            example: "Thought 1: 需要分析用户需求 → Action 1: 收集用户数据 → Observation 1: 发现痛点 → Thought 2: 设计解决方案..."
                        },
                        "模块化设计": {
                            description: "将提示词做成可复用模块",
                            explanation: "像乐高积木一样，把常用的部分做成标准模块，需要时就拿来组装。",
                            example: "角色模块：'你是[专业领域]专家' + 任务模块：'请分析[具体问题]' + 格式模块：'按1.2.3.格式输出' + 质量模块：'确保准确客观'"
                        },
                        "Prompt Function化": {
                            description: "将提示词模块函数化，可复用、组合、参数化调用",
                            explanation: "像写代码一样构建提示逻辑，每个模块都是一个函数，可以复用和组合。",
                            example: "summarize(input, style='bullet_points', length=200)\n↓\n'请将以下内容总结为要点形式，控制在200字内：[input]'"
                        },
                        "递归结构提示": {
                            description: "提示体可自调用并根据上次生成结果调整当前行为",
                            explanation: "像函数调用自己一样，提示词可以基于前一轮的结果继续深化。",
                            example: "第一轮：生成初步分析 → 第二轮：基于初步结果深入分析 → 第三轮：基于深入分析提出建议"
                        },
                        "原子化拆分": {
                            description: "拆到最小不可分单元",
                            explanation: "像化学分解一样，把复杂指令拆分到最基本的、不能再分的指令单元。",
                            example: "复杂指令：'分析并评价这个方案'\n原子化：'第一步：理解方案内容 → 第二步：列出优点 → 第三步：找出缺点 → 第四步：给出改进建议'"
                        },
                        "接口标准化": {
                            description: "定义模块间连接规范",
                            explanation: "像电脑接口一样，定义不同模块之间如何连接和传递信息的标准。",
                            example: "输入接口：'前置条件：[必需信息]' + 处理接口：'处理方式：[方法名称]' + 输出接口：'输出格式：[标准格式]'"
                        }
                    },
                    "框架应用": {
                        "模板化": {
                            description: "创建填空式提示词模板",
                            explanation: "像填表格一样，把提示词做成模板，只需要填入具体内容就能使用。",
                            example: "通用模板：'作为[角色]，请为[目标用户]完成[具体任务]，要求[质量标准]，输出[格式要求]'\n实例：'作为产品经理，请为开发团队完成需求分析，要求逻辑清晰，输出结构化文档'"
                        },
                        "框架套用": {
                            description: "使用SWOT、5W1H等成熟框架",
                            explanation: "借用已经被验证有效的思维框架，让AI按照这些成熟的方法来思考。",
                            example: "PDCA循环：'Plan计划：制定目标和方案 → Do执行：实施具体行动 → Check检查：评估执行效果 → Act改进：优化和调整'"
                        },
                        "思维导图化": {
                            description: "树状结构组织信息",
                            explanation: "像画家族谱一样，把信息按照层级关系排列，主题→分支→细节。",
                            example: "中心：产品策略\n├─ 市场分析\n│  ├─ 目标用户\n│  ├─ 竞争对手\n│  └─ 市场趋势\n├─ 产品定位\n└─ 推广策略"
                        },
                        "矩阵化组织": {
                            description: "二维表格结构化",
                            explanation: "像Excel表格一样，用行列交叉的方式组织信息，便于比较和分析。",
                            example: "功能需求矩阵：\n          | 重要性 | 紧急性 | 实现难度 | 资源需求\n功能A     |   高   |   高   |    低    |    中\n功能B     |   中   |   低   |    高    |    高"
                        },
                        "流程图设计": {
                            description: "用流程逻辑串联",
                            explanation: "像画流程图一样，用箭头和框框把处理步骤串联起来。",
                            example: "开始 → 输入问题 → 判断类型 → [如果A类型]处理A → [如果B类型]处理B → 整合结果 → 输出答案 → 结束"
                        }
                    },
                    "逻辑编排": {
                        "链式思考": {
                            description: "设计推理步骤链条",
                            explanation: "像多米诺骨牌一样，一步推导出下一步，环环相扣。",
                            example: "推理链：'因为市场需求增长 → 所以需要扩大产能 → 因此需要增加投资 → 所以要寻找资金来源 → 最终选择融资方案'"
                        },
                        "条件分支": {
                            description: "if-then规则设置",
                            explanation: "像程序的if-else语句一样，根据不同条件执行不同的处理逻辑。",
                            example: "条件判断：'如果用户是新手 → 提供基础教程；如果用户有经验 → 提供高级功能；如果用户是专家 → 提供定制化选项'"
                        },
                        "递归深化": {
                            description: "对结果再次深入挖掘",
                            explanation: "像俄罗斯套娃一样，一层层深入，每次都在前一次的基础上进一步挖掘。",
                            example: "递归分析：'表面问题：用户流失 → 深层问题：用户体验差 → 根本问题：产品功能不匹配需求 → 本质问题：市场调研不足'"
                        },
                        "循环迭代": {
                            description: "设置重复执行逻辑",
                            explanation: "像洗衣机的洗涤程序一样，重复执行某个过程直到达到满意的结果。",
                            example: "迭代优化：'生成初版方案 → 评估效果 → 发现问题 → 改进方案 → 重复直到满意 → 输出最终方案'"
                        },
                        "并行处理": {
                            description: "同时处理多个分支",
                            explanation: "像多线程处理一样，同时从多个角度或维度来分析问题。",
                            example: "并行分析：'同时从技术可行性、商业价值、用户需求、资源投入四个维度评估这个项目'"
                        }
                    }
                }
            },
            "内容性操作": {
                icon: "💬",
                description: "改变提示词的信息内容和表达方式",
                level: "basic",
                gradient: "category-gradient-2",
                methods: {
                    "信息转换": {
                        "密度控制": {
                            description: "调整信息浓缩程度",
                            explanation: "像调节咖啡浓度一样，控制信息的密集程度，该详细时详细，该简洁时简洁。",
                            example: "高密度：'用50字概括核心要点'\n中密度：'用300字详细说明'\n低密度：'用1000字深入阐述，包含背景、过程、案例'"
                        },
                        "粒度调节": {
                            description: "控制细节层次",
                            explanation: "像调节显微镜倍数一样，控制观察问题的精细程度。",
                            example: "宏观：'从行业趋势角度分析'\n中观：'从企业战略角度分析'\n微观：'从具体功能角度分析'"
                        },
                        "认知负载调节": {
                            description: "分层控制复杂度",
                            explanation: "像游戏设计关卡难度一样，按照理解能力分层展示信息。",
                            example: "入门版：'用一句话说明核心概念'\n进阶版：'用三个要点展开说明'\n专业版：'提供完整的技术细节和理论依据'"
                        },
                        "抽象度变换": {
                            description: "具体↔抽象转换",
                            explanation: "像电梯一样，在具体案例和抽象原理之间上下移动。",
                            example: "具体→抽象：'从苹果手机的成功 → 总结出产品设计的通用原理'\n抽象→具体：'将设计思维理论 → 应用到具体的APP设计中'"
                        },
                        "专业度调节": {
                            description: "通俗↔专业转换",
                            explanation: "像调节语言频道一样，在专业术语和通俗表达之间切换。",
                            example: "通俗版：'用大白话解释区块链'\n专业版：'用学术语言分析分布式账本技术的密码学基础'"
                        }
                    },
                    "语义映射": {
                        "类比映射": {
                            description: "用熟悉事物解释陌生概念",
                            explanation: "像翻译官一样，用大家都懂的事物来解释复杂的新概念。",
                            example: "'用做菜的过程来解释软件开发：准备食材=需求分析，制定菜谱=系统设计，炒菜过程=编码实现，品尝调味=测试优化'"
                        },
                        "隐喻构建": {
                            description: "创造比喻体系",
                            explanation: "不只是一个比喻，而是构建一整套相互关联的比喻系统。",
                            example: "企业生态系统隐喻：CEO=狮王，管理层=食物链顶端，员工=各种动物，市场=栖息地，竞争=生存斗争，创新=进化适应"
                        },
                        "符号系统转换": {
                            description: "不同表达形式间转换",
                            explanation: "像多语言翻译一样，把同样的信息用不同的'语言'表达出来。",
                            example: "'把数据表格转换成故事叙述：数字变成情节，趋势变成故事发展，异常变成转折点'"
                        },
                        "概念桥接": {
                            description: "建立概念间联系",
                            explanation: "像建桥一样，在新旧概念之间建立连接，帮助理解。",
                            example: "'将人工智能概念与大脑神经网络联系：神经元=节点，突触=连接权重，学习=权重调整'"
                        },
                        "域间迁移": {
                            description: "跨知识领域转换",
                            explanation: "像把一个领域的成功经验移植到另一个领域。",
                            example: "'将军事战略原理应用到商业竞争：兵力=资源，战场=市场，情报=市场调研，战术=营销策略'"
                        }
                    },
                    "表达优化": {
                        "语言风格编码": {
                            description: "指定特定作家或流派风格",
                            explanation: "像模仿名人说话一样，让AI学习特定的写作风格。",
                            example: "'用海明威的简洁风格写技术文档：短句，直接，避免修饰词'\n'用乔布斯的演讲风格介绍产品：激情，简洁，重点突出'"
                        },
                        "修辞手法应用": {
                            description: "运用特定修辞技巧",
                            explanation: "像化妆师一样，用修辞手法为文字'化妆'，让表达更生动有力。",
                            example: "'用排比强调：我们要创新，要突破，要领先'\n'用对比突出：传统方法复杂低效，新方法简单高效'\n'用设问引导：为什么选择我们？因为...'"
                        },
                        "叙事结构选择": {
                            description: "线性/非线性叙述",
                            explanation: "像导演选择叙事手法一样，决定故事的讲述顺序和方式。",
                            example: "线性叙述：'按时间顺序讲述项目发展过程'\n倒叙：'先展示成果，再回顾实现过程'\n蒙太奇：'多个片段交叉展示，形成完整画面'"
                        },
                        "论证模式设定": {
                            description: "归纳/演绎/类比论证",
                            explanation: "像律师选择论证策略一样，选择最有说服力的论证方式。",
                            example: "演绎论证：'大前提：优秀产品都注重用户体验 → 小前提：我们的产品注重用户体验 → 结论：我们的产品是优秀的'\n归纳论证：'案例1、案例2、案例3都证明...因此可以得出...'"
                        }
                    }
                }
            },
            "约束性操作": {
                icon: "🎛️",
                description: "设置提示词的限制条件和规则边界",
                level: "basic",
                gradient: "category-gradient-3",
                methods: {
                    "硬性约束": {
                        "格式限定": {
                            description: "输出格式要求",
                            explanation: "像设定模板一样，严格规定输出的格式和结构。",
                            example: "格式要求：'必须按以下格式输出：\n## 标题\n### 子标题\n- 要点1\n- 要点2\n**重点内容**'"
                        },
                        "长度限制": {
                            description: "字数/段落限制",
                            explanation: "像限制作文字数一样，严格控制输出的长度。",
                            example: "'回答控制在200-300字之间'\n'每段不超过50字'\n'总共不超过5个段落'"
                        },
                        "时间约束": {
                            description: "时限内完成",
                            explanation: "像考试限时一样，要求在指定时间内完成任务。",
                            example: "'假设你只有5分钟时间向投资人介绍项目'\n'在30秒内说明核心价值'"
                        },
                        "资源约束": {
                            description: "可用信息限制",
                            explanation: "像闭卷考试一样，只能使用指定的信息来源。",
                            example: "'仅基于提供的材料进行分析，不要添加外部信息'\n'只能使用文档中的数据'"
                        }
                    },
                    "软性约束": {
                        "优先级排序": {
                            description: "设定重要性顺序",
                            explanation: "像排队一样，告诉AI哪些要求最重要，哪些可以妥协。",
                            example: "优先级：'1.准确性（不可妥协） > 2.完整性（重要） > 3.生动性（次要） > 4.字数（可调整）'"
                        },
                        "权重分配": {
                            description: "不同要素的比重",
                            explanation: "像配菜谱一样，告诉AI各种成分的比例。",
                            example: "'理论占30%，实践案例占50%，未来展望占20%'\n'技术分析60% + 市场分析40%'"
                        },
                        "容错范围": {
                            description: "可接受的偏差",
                            explanation: "像设定公差一样，允许在一定范围内的偏差。",
                            example: "'数据误差在±5%内可接受'\n'风格可以适度调整，但核心信息必须准确'"
                        },
                        "质量标准": {
                            description: "评判标准设定",
                            explanation: "像设定及格线一样，明确什么样的输出是合格的。",
                            example: "'达到大学本科论文水准'\n'符合行业标准规范'\n'普通人能够理解'"
                        }
                    },
                    "否定约束": {
                        "禁止项列举": {
                            description: "明确不要什么",
                            explanation: "像列黑名单一样，明确告诉AI绝对不能做的事情。",
                            example: "禁止清单：'1.不要使用专业术语 2.不要超过500字 3.不要提及竞争对手 4.不要包含个人观点'"
                        },
                        "规避内容": {
                            description: "敏感话题回避",
                            explanation: "像设定禁区一样，让AI避开可能有争议的内容。",
                            example: "'避免涉及政治敏感话题'\n'不要讨论具体的投资建议'\n'避免对个人隐私的猜测'"
                        },
                        "风格排除": {
                            description: "不采用的风格",
                            explanation: "像选衣服时说不要什么风格一样，明确不想要的表达方式。",
                            example: "'不要学术论文式的严肃风格'\n'不要营销软文式的夸张表达'\n'不要过于正式的官方语调'"
                        },
                        "错误预防": {
                            description: "常见错误提醒",
                            explanation: "像考试前的提醒一样，预先告知容易出错的地方。",
                            example: "'注意避免逻辑跳跃'\n'确保前后一致'\n'避免过度概括'\n'注意因果关系的准确性'"
                        }
                    }
                }
            },
            "上下文操作": {
                icon: "🎭",
                description: "管理提示词的背景信息和环境设定",
                level: "advanced",
                gradient: "category-gradient-4",
                methods: {
                    "时空设定": {
                        "时间轴操作": {
                            description: "改变时间维度",
                            explanation: "像时间旅行一样，把分析放在不同的时间点来看问题。",
                            example: "'假设现在是1990年，没有互联网，如何推广产品？'\n'从2030年回望今天的决策，什么最重要？'"
                        },
                        "空间定位": {
                            description: "地理/文化背景",
                            explanation: "像设定电影拍摄地点一样，为分析设定特定的地理和文化环境。",
                            example: "'在中国文化背景下分析这个商业模式'\n'考虑硅谷创业环境的特点'\n'在农村市场环境下评估可行性'"
                        },
                        "历史背景": {
                            description: "特定历史时期",
                            explanation: "把分析放在特定的历史时期，考虑当时的环境和限制。",
                            example: "'在工业革命时期，这个发明会产生什么影响？'\n'二战后重建时期的管理思想对今天有什么启发？'"
                        },
                        "未来设想": {
                            description: "科幻/预测场景",
                            explanation: "像科幻小说一样，设想未来的技术和社会环境。",
                            example: "'2050年AI普及后，这个行业会如何变化？'\n'在火星殖民地环境下，如何设计管理制度？'"
                        }
                    },
                    "知识背景": {
                        "语境植入": {
                            description: "预设前提知识",
                            explanation: "像给演员讲戏一样，提前告诉AI相关的背景信息。",
                            example: "'基于我们之前讨论的用户画像理论'\n'考虑到公司当前的资金状况'\n'结合行业发展的三个阶段'"
                        },
                        "专业领域设定": {
                            description: "特定学科背景",
                            explanation: "像戴上专业眼镜一样，从特定专业领域的角度来看问题。",
                            example: "'从心理学角度分析用户行为'\n'用经济学原理解释市场现象'\n'从工程学角度评估技术方案'"
                        },
                        "文化语境": {
                            description: "文化背景预设",
                            explanation: "考虑特定文化背景下的价值观和行为习惯。",
                            example: "'在东方集体主义文化下分析团队管理'\n'考虑西方个人主义价值观的影响'\n'结合儒家文化传统'"
                        },
                        "先验知识": {
                            description: "假定已知信息",
                            explanation: "像跟老朋友聊天一样，假设对方已经知道某些基础信息。",
                            example: "'假设读者已经了解基本的营销理论'\n'基于对区块链的基本认知'\n'在熟悉产品功能的前提下'"
                        }
                    },
                    "情境营造": {
                        "场景描述": {
                            description: "具体情境设定",
                            explanation: "像搭建舞台场景一样，为分析设定具体的应用场景。",
                            example: "'在紧急危机处理的会议室中'\n'面对愤怒客户的投诉现场'\n'在投资人路演的关键时刻'"
                        },
                        "氛围渲染": {
                            description: "情绪氛围营造",
                            explanation: "像电影配乐一样，为分析营造特定的情绪氛围。",
                            example: "'在紧张激烈的竞争环境中'\n'保持冷静客观的分析氛围'\n'在轻松友好的讨论氛围下'"
                        },
                        "利益相关方": {
                            description: "涉及人物关系",
                            explanation: "像分析人物关系一样，考虑所有相关人员的利益和立场。",
                            example: "'考虑股东、员工、客户、供应商的不同立场'\n'平衡管理层和员工的利益'\n'兼顾短期和长期利益相关者'"
                        },
                        "问题情境": {
                            description: "具体问题背景",
                            explanation: "设定具体的问题情境，让分析更有针对性。",
                            example: "'面临资金链断裂的紧急情况'\n'在市场份额快速下滑的背景下'\n'新技术颠覆传统行业的转折点'"
                        }
                    }
                }
            },
            "本体性操作": {
                icon: "🧠",
                description: "在存在论层面改变认知框架和概念体系",
                level: "expert",
                gradient: "category-gradient-5",
                methods: {
                    "实体识别": {
                        "主体界定": {
                            description: "定义行动者的本质属性",
                            explanation: "重新思考'这个东西到底是什么'，改变对事物本质的理解。",
                            example: "'将用户重新定义为学习系统，而不是被动接受者'\n'把公司看作有机生命体，而不是机械组织'"
                        },
                        "客体构建": {
                            description: "重新定义操作对象的存在形式",
                            explanation: "改变对处理对象的根本认知，重新定义它的存在方式。",
                            example: "'将问题重新定义为机会的种子'\n'把竞争看作生态系统的协同进化'"
                        },
                        "边界重划": {
                            description: "重新划分实体的边界",
                            explanation: "像重新画地图一样，重新定义事物的边界和范围。",
                            example: "'将企业边界扩展到整个价值网络'\n'把产品边界延伸到用户体验的全生命周期'"
                        },
                        "层次解构": {
                            description: "识别实体的组成层次",
                            explanation: "像解剖一样，识别事物由哪些层次构成，每层有什么特性。",
                            example: "'人的层次：生理→心理→社会→精神'\n'组织层次：个人→团队→部门→公司→生态'"
                        }
                    },
                    "属性转换": {
                        "本质属性识别": {
                            description: "区分核心属性vs偶然属性",
                            explanation: "像挖掘宝藏一样，找到事物最核心、最本质的属性。",
                            example: "'智能的本质是适应能力还是计算能力？'\n'领导的核心是权力还是影响力？'"
                        },
                        "属性空间映射": {
                            description: "在不同属性空间中定位",
                            explanation: "把同一个事物放在不同的属性坐标系中来理解。",
                            example: "'从物理属性（大小、重量）转向价值属性（效用、意义）'\n'从功能属性转向情感属性'"
                        },
                        "维度升降": {
                            description: "改变描述的维度数量",
                            explanation: "像从2D升级到3D一样，增加或减少分析的维度。",
                            example: "'从一维的成本考虑，升级到成本-质量-时间三维分析'\n'将复杂的多维问题简化为核心二维'"
                        },
                        "属性生成": {
                            description: "创造新的属性类别",
                            explanation: "像发明新词汇一样，创造全新的属性概念。",
                            example: "'定义产品的数字生命力属性'\n'创造组织的学习敏捷度指标'"
                        }
                    },
                    "关系重构": {
                        "因果本体": {
                            description: "重新定义因果关系链",
                            explanation: "重新思考什么是因、什么是果，改变因果关系的理解。",
                            example: "'从症状←疾病改为系统失衡→多重表现'\n'从问题→解决改为机会→创造'"
                        },
                        "整体-部分关系": {
                            description: "重构组成关系",
                            explanation: "重新理解整体和部分的关系，不是简单的相加。",
                            example: "'团队不是个人的简单相加，而是涌现的新系统'\n'产品不是功能的组合，而是体验的整体'"
                        },
                        "依存关系": {
                            description: "识别存在依赖性",
                            explanation: "分析事物的存在是否依赖于其他事物。",
                            example: "'品牌价值依存于用户认知还是独立存在？'\n'创新依存于资源还是依存于文化？'"
                        },
                        "生成关系": {
                            description: "定义事物如何产生",
                            explanation: "重新理解事物是如何产生和发展的。",
                            example: "'知识是发现的还是建构的？'\n'价值是创造的还是转移的？'"
                        }
                    },
                    "范畴体系": {
                        "分类本体": {
                            description: "重新设计分类体系",
                            explanation: "像重新设计图书分类法一样，创造新的分类方式。",
                            example: "'按问题解决的复杂度分类，而不是按传统学科分类'\n'按用户价值层次分类产品功能'"
                        },
                        "概念网络": {
                            description: "构建概念间的网络关系",
                            explanation: "像绘制知识图谱一样，建立概念之间的网络连接。",
                            example: "'创新-风险-机会-资源形成概念网络'\n'用户-需求-价值-体验的概念联结'"
                        },
                        "抽象层级": {
                            description: "在不同抽象层次间移动",
                            explanation: "像电梯一样，在具体现象和抽象原理之间自由移动。",
                            example: "'现象：用户流失→模式：价值不匹配→原理：需求层次理论→元原理：人性本质'"
                        },
                        "范畴创新": {
                            description: "创造新的概念范畴",
                            explanation: "像科学家命名新物种一样，创造全新的概念类别。",
                            example: "'定义数字原住民这个新人群范畴'\n'创造智能增强型组织这个新概念'"
                        }
                    },
                    "存在模式": {
                        "静态存在": {
                            description: "事物作为状态的存在",
                            explanation: "把事物看作稳定的状态或结构。",
                            example: "'组织作为层级结构存在'\n'产品作为功能集合存在'"
                        },
                        "动态过程": {
                            description: "事物作为过程的存在",
                            explanation: "把事物看作持续变化的过程。",
                            example: "'组织作为持续的组织化过程'\n'产品作为用户体验的演化过程'"
                        },
                        "关系存在": {
                            description: "事物通过关系而存在",
                            explanation: "认为事物是通过与其他事物的关系而存在的。",
                            example: "'品牌通过与用户的关系而存在'\n'价值通过交换关系而体现'"
                        },
                        "潜在存在": {
                            description: "可能性空间的存在",
                            explanation: "考虑事物未实现但可能的状态。",
                            example: "'分析产品的潜在发展空间'\n'探索组织的可能性边界'"
                        }
                    }
                }
            },
            "过程性操作": {
                icon: "🔄",
                description: "控制提示词的执行过程和交互方式",
                level: "advanced",
                gradient: "category-gradient-6",
                methods: {
                    "执行控制": {
                        "顺序执行": {
                            description: "线性步骤执行",
                            explanation: "像走楼梯一样，一步一步按顺序执行任务。",
                            example: "'第一步：收集信息 → 第二步：分析数据 → 第三步：得出结论 → 第四步：提出建议'"
                        },
                        "并行执行": {
                            description: "同时多任务",
                            explanation: "像多线程处理一样，同时处理多个任务。",
                            example: "'同时从技术、市场、资金三个维度分析项目可行性'\n'并行评估风险和机会'"
                        },
                        "条件执行": {
                            description: "满足条件才执行",
                            explanation: "像程序的条件语句一样，只有满足特定条件才执行某些步骤。",
                            example: "'如果市场分析显示可行性>70%，则进行详细的商业计划制定'\n'只有在确认用户需求后，才设计解决方案'"
                        },
                        "循环执行": {
                            description: "重复直到满足",
                            explanation: "像洗衣机的洗涤程序一样，重复某个过程直到达到目标。",
                            example: "'重复优化方案，直到用户满意度达到90%'\n'循环测试修改，直到通过所有验收标准'"
                        }
                    },
                    "交互模式": {
                        "单向输出": {
                            description: "一次性完成",
                            explanation: "像写信一样，一次性完成全部内容的输出。",
                            example: "'一次性生成完整的项目报告'\n'提供完整的解决方案，不需要进一步交互'"
                        },
                        "对话交互": {
                            description: "多轮对话",
                            explanation: "像聊天一样，通过多轮对话逐步深入和完善。",
                            example: "'先提供框架概要，根据反馈再详细展开'\n'逐步澄清需求，分阶段提供解决方案'"
                        },
                        "协作交互": {
                            description: "人机协同",
                            explanation: "像搭档合作一样，人和AI各自发挥优势共同完成任务。",
                            example: "'你负责提供专业分析，我来结合实际情况判断'\n'AI生成多个方案，人类选择和优化'"
                        },
                        "验证交互": {
                            description: "确认后继续",
                            explanation: "像走楼梯时确认脚步一样，每一步都确认无误后再继续。",
                            example: "'完成每个步骤后，请确认理解正确再进行下一步'\n'在关键决策点暂停，等待确认'"
                        }
                    },
                    "反馈机制": {
                        "自我评估": {
                            description: "AI自检输出",
                            explanation: "像做完作业后自己检查一样，AI自己评估输出质量。",
                            example: "'完成分析后，请检查：1.逻辑是否严密 2.事实是否准确 3.结论是否合理'"
                        },
                        "迭代改进": {
                            description: "基于反馈优化",
                            explanation: "像软件升级一样，根据使用反馈不断改进。",
                            example: "'根据用户反馈的问题，重新调整方案'\n'基于测试结果，优化解决方案'"
                        },
                        "错误修正": {
                            description: "发现并纠正错误",
                            explanation: "像校对文章一样，主动发现和纠正可能的错误。",
                            example: "'发现逻辑矛盾时，请指出并提供修正建议'\n'如果数据有冲突，请说明并给出合理解释'"
                        },
                        "质量控制": {
                            description: "输出质量把关",
                            explanation: "像质检员一样，确保输出达到质量标准。",
                            example: "'确保所有建议都有可操作性'\n'验证所有数据的准确性和时效性'"
                        }
                    }
                }
            },
            "元认知操作": {
                icon: "🎯",
                description: "对提示词本身进行操作和优化",
                level: "expert",
                gradient: "category-gradient-7",
                methods: {
                    "提示词生成": {
                        "元提示词": {
                            description: "AI生成提示词",
                            explanation: "让AI成为提示词专家，帮你设计更好的提示词。",
                            example: "'请作为提示词工程师，为XX任务设计最优的提示词，要求包含角色设定、任务描述、输出格式、质量标准'"
                        },
                        "提示词优化": {
                            description: "改进现有提示词",
                            explanation: "像编辑修改文章一样，优化提示词的效果。",
                            example: "'这个提示词效果不好：[原提示词]，请分析问题并提供改进版本'"
                        },
                        "提示词评估": {
                            description: "评价提示词质量",
                            explanation: "像评委打分一样，评估提示词的质量和效果。",
                            example: "'请从清晰度、完整性、可执行性、预期效果四个维度评估这个提示词'"
                        },
                        "提示词调试": {
                            description: "诊断问题所在",
                            explanation: "像医生诊断病情一样，找出提示词效果不好的原因。",
                            example: "'分析为什么这个提示词的输出总是偏离预期，可能的问题在哪里？'"
                        }
                    },
                    "策略选择": {
                        "方法推荐": {
                            description: "推荐最佳方法",
                            explanation: "像顾问一样，为特定问题推荐最适合的解决方法。",
                            example: "'对于创意生成类任务，建议使用发散思维+约束条件的组合方法'"
                        },
                        "路径规划": {
                            description: "设计实现路径",
                            explanation: "像导航一样，设计从当前状态到目标状态的最佳路径。",
                            example: "'要实现这个复杂目标，建议分三个阶段：基础建设→核心功能→优化完善'"
                        },
                        "工具选择": {
                            description: "选择合适工具",
                            explanation: "像工匠选择工具一样，为不同任务选择最合适的工具。",
                            example: "'对于结构化分析，推荐使用SWOT框架；对于创新思考，推荐使用六顶思考帽'"
                        },
                        "资源配置": {
                            description: "分配注意力资源",
                            explanation: "像分配预算一样，决定在哪些方面投入更多精力。",
                            example: "'这个任务中，建议60%精力放在需求分析，30%放在方案设计，10%放在风险评估'"
                        }
                    },
                    "知识管理": {
                        "经验总结": {
                            description: "提炼成功模式",
                            explanation: "像写总结报告一样，从成功案例中提炼可复用的模式。",
                            example: "'从这三个成功案例中，总结出可复用的提示词设计模式'"
                        },
                        "模式识别": {
                            description: "发现通用模式",
                            explanation: "像科学家发现定律一样，识别跨领域的通用规律。",
                            example: "'分析这些有效提示词的共同特征，发现通用的设计原则'"
                        },
                        "知识迁移": {
                            description: "跨域应用",
                            explanation: "像把一个领域的成功经验移植到另一个领域。",
                            example: "'将产品设计中的用户体验原则，应用到提示词设计中'"
                        },
                        "创新组合": {
                            description: "创造新方法",
                            explanation: "像发明家一样，组合现有方法创造新的解决方案。",
                            example: "'结合结构化思维+情境设定+角色扮演，创造新的提示词方法'"
                        }
                    }
                }
            },
            "效果增强操作": {
                icon: "✨",
                description: "提升提示词的效果和影响力",
                level: "advanced",
                gradient: "category-gradient-8",
                methods: {
                    "认知增强": {
                        "记忆辅助": {
                            description: "帮助记忆要点",
                            explanation: "像制作记忆口诀一样，帮助更好地记住重要信息。",
                            example: "'用首字母缩写SMART帮助记忆目标设定原则：Specific, Measurable, Achievable, Relevant, Time-bound'"
                        },
                        "理解促进": {
                            description: "提升理解深度",
                            explanation: "像老师讲课一样，层层递进加深理解。",
                            example: "'先解释概念，再举例说明，然后分析原理，最后练习应用'"
                        },
                        "联想激发": {
                            description: "激发创意联想",
                            explanation: "像头脑风暴一样，激发更多的创意和联想。",
                            example: "'从这个想法出发，还能联想到哪些相关的创意？试着突破常规思维'"
                        },
                        "洞察深化": {
                            description: "深层洞察挖掘",
                            explanation: "像考古学家一样，挖掘表面现象背后的深层规律。",
                            example: "'透过用户行为的表面现象，分析背后的心理动机和价值需求'"
                        }
                    },
                    "情感增强": {
                        "共鸣营造": {
                            description: "情感共鸣设计",
                            explanation: "像优秀的演讲者一样，与听众建立情感连接。",
                            example: "'用真实的用户故事引起共鸣，让抽象的数据变得有温度'"
                        },
                        "动机激发": {
                            description: "激发行动动力",
                            explanation: "像教练一样，激励人们采取行动。",
                            example: "'不只是分析问题，更要展示解决问题后的美好前景，激发行动意愿'"
                        },
                        "信任建立": {
                            description: "增强可信度",
                            explanation: "像专家顾问一样，建立专业可信的形象。",
                            example: "'提供具体的数据支撑，引用权威来源，展示逻辑推理过程'"
                        },
                        "趣味注入": {
                            description: "增加趣味性",
                            explanation: "像娱乐节目一样，让严肃的内容变得生动有趣。",
                            example: "'用生动的比喻、有趣的案例、适当的幽默让枯燥的内容生动起来'"
                        }
                    },
                    "实用增强": {
                        "可操作性": {
                            description: "具体行动指南",
                            explanation: "像操作手册一样，提供具体可执行的步骤。",
                            example: "'不只说要改进用户体验，而是具体说明：1.收集用户反馈 2.分析痛点 3.制定改进方案 4.测试验证'"
                        },
                        "适应性": {
                            description: "灵活应变能力",
                            explanation: "像变色龙一样，能够适应不同的情况和需求。",
                            example: "'提供基础版、进阶版、定制版三套方案，适应不同的资源和需求情况'"
                        },
                        "可验证性": {
                            description: "结果可验证",
                            explanation: "像科学实验一样，设置可以验证结果的标准。",
                            example: "'设定明确的成功指标：用户满意度提升20%，响应时间缩短50%'"
                        },
                        "可复制性": {
                            description: "方法可复制",
                            explanation: "像制作模板一样，让成功经验可以复制推广。",
                            example: "'将成功方法标准化为可复制的流程模板，包含详细的操作步骤和注意事项'"
                        }
                    }
                }
            }
        };
        // 操作层次定义
        const levelConfig = {
            basic: { name: "🟢 基础层", color: "level-basic", description: "结构性+内容性+约束性操作" },
            advanced: { name: "🟡 进阶层", color: "level-advanced", description: "上下文+过程性+效果增强操作" },
            expert: { name: "🔴 高级层", color: "level-expert", description: "本体性+元认知操作" }
        };
        let currentCategory = "结构性操作";
        let searchResults = [];
        // 初始化页面
        function initializePage() {
            renderCategoryNav();
            renderCategoryIntro(currentCategory);
            renderMethods(currentCategory);
            setupSearch();
        }
        // 渲染分类导航
        function renderCategoryNav() {
            const nav = document.getElementById('categoryNav');
            nav.innerHTML = '';
            
            Object.keys(methodsDatabase).forEach((category, index) => {
                const categoryData = methodsDatabase[category];
                const levelInfo = levelConfig[categoryData.level];
                
                const button = document.createElement('button');
                button.className = `w-full text-left px-4 py-3 rounded-lg transition-all duration-200 ${
                    category === currentCategory 
                        ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-medium' 
                        : 'text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'
                }`;
                button.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-lg mr-3">${categoryData.icon}</span>
                            <span class="text-sm font-medium">${category}</span>
                        </div>
                        <span class="level-badge ${levelInfo.color} text-xs">${levelInfo.name.slice(2)}</span>
                    </div>
                `;
                button.onclick = () => selectCategory(category);
                nav.appendChild(button);
            });
        }
        // 选择分类
        function selectCategory(category) {
            currentCategory = category;
            renderCategoryNav();
            renderCategoryIntro(category);
            renderMethods(category);
        }
        // 渲染分类介绍
        function renderCategoryIntro(category) {
            const intro = document.getElementById('categoryIntro');
            const data = methodsDatabase[category];
            const levelInfo = levelConfig[data.level];
            
            intro.innerHTML = `
                <div class="flex items-center mb-4">
                    <div class="w-16 h-16 ${data.gradient} rounded-xl flex items-center justify-center mr-4">
                        <span class="text-3xl">${data.icon}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">${category}</h2>
                            <span class="level-badge ${levelInfo.color}">${levelInfo.name}</span>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400">${data.description}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-500 mt-1">${levelInfo.description}</p>
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                    <span>共 ${Object.keys(data.methods).length} 个二级分类，${Object.values(data.methods).reduce((total, methods) => total + Object.keys(methods).length, 0)} 个具体方法</span>
                    <span class="text-blue-600 dark:text-blue-400">点击方法卡片查看详细说明</span>
                </div>
            `;
        }
        // 渲染方法列表
        function renderMethods(category) {
            const container = document.getElementById('methodsList');
            const data = methodsDatabase[category];
            container.innerHTML = '';
            Object.entries(data.methods).forEach(([subCategory, methods]) => {
                const section = document.createElement('div');
                section.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden';
                
                section.innerHTML = `
                    <div class="px-6 py-4 bg-gray-50 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${subCategory}</h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                            ${Object.entries(methods).map(([methodName, methodData]) => `
                                <div class="method-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 cursor-pointer border border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-600"
                                     onclick="showMethodDetail('${category}', '${subCategory}', '${methodName}')">
                                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">${methodName}</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">${methodData.description}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(section);
            });
        }
        // 显示方法详情
        function showMethodDetail(category, subCategory, methodName) {
            const methodData = methodsDatabase[category].methods[subCategory][methodName];
            
            document.getElementById('modalTitle').textContent = methodName;
            document.getElementById('modalCategory').textContent = `${category} > ${subCategory}`;
            
            document.getElementById('modalContent').innerHTML = `
                <div class="space-y-6">
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-900 dark:text-blue-300 mb-2">📝 方法说明</h4>
                        <p class="text-blue-800 dark:text-blue-200">${methodData.description}</p>
                    </div>
                    
                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                        <h4 class="font-semibold text-green-900 dark:text-green-300 mb-2">💡 大白话解释</h4>
                        <p class="text-green-800 dark:text-green-200">${methodData.explanation}</p>
                    </div>
                    
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4">
                        <h4 class="font-semibold text-yellow-900 dark:text-yellow-300 mb-2">🎯 典型示例</h4>
                        <div class="text-yellow-800 dark:text-yellow-200 whitespace-pre-line font-mono text-sm bg-white dark:bg-gray-800 p-4 rounded border leading-relaxed">${methodData.example}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('methodModal').classList.remove('hidden');
        }
        // 关闭模态框
        function closeModal() {
            document.getElementById('methodModal').classList.add('hidden');
        }
        // 设置搜索功能
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                if (query) {
                    performSearch(query);
                } else {
                    renderMethods(currentCategory);
                }
            });
        }
        // 执行搜索
        function performSearch(query) {
            const results = [];
            
            Object.entries(methodsDatabase).forEach(([category, categoryData]) => {
                Object.entries(categoryData.methods).forEach(([subCategory, methods]) => {
                    Object.entries(methods).forEach(([methodName, methodData]) => {
                        const searchText = `${methodName} ${methodData.description} ${methodData.explanation} ${methodData.example}`.toLowerCase();
                        if (searchText.includes(query)) {
                            results.push({
                                category,
                                subCategory,
                                methodName,
                                methodData,
                                categoryData
                            });
                        }
                    });
                });
            });
            
            renderSearchResults(results, query);
        }
        // 渲染搜索结果
        function renderSearchResults(results, query) {
            const container = document.getElementById('methodsList');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-gray-400 text-6xl mb-4">🔍</div>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">未找到相关方法</h3>
                        <p class="text-gray-500 dark:text-gray-400">尝试使用其他关键词搜索</p>
                    </div>
                `;
                return;
            }
            container.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="px-6 py-4 bg-gray-50 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            搜索结果 <span class="text-blue-600 dark:text-blue-400">"${query}"</span> 
                            <span class="text-sm font-normal text-gray-500 dark:text-gray-400">(${results.length} 个结果)</span>
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            ${results.map(result => {
                                const levelInfo = levelConfig[result.categoryData.level];
                                return `
                                <div class="method-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 cursor-pointer border border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-600"
                                     onclick="showMethodDetail('${result.category}', '${result.subCategory}', '${result.methodName}')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center mb-2">
                                                <span class="text-lg mr-2">${result.categoryData.icon}</span>
                                                <h4 class="font-medium text-gray-900 dark:text-white">${result.methodName}</h4>
                                                <span class="level-badge ${levelInfo.color} ml-2">${levelInfo.name.slice(2)}</span>
                                            </div>
                                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${result.methodData.description}</p>
                                            <div class="text-xs text-gray-500 dark:text-gray-500">
                                                ${result.category} > ${result.subCategory}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `}).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        // 获取语言名称
        function getLanguageName(langCode) {
            const languageNames = {
                zh: '中文',
                en: 'English',
                ja: '日本語',
                ko: '한국어',
                fr: 'Français',
                de: 'Deutsch',
                es: 'Español'
            };
            return languageNames[langCode] || langCode;
        }
        // 优秀提示词示例库（多语言）
        const excellentPrompts = {
            1: `你是一位资深的产品经理，拥有10年的互联网产品经验。请为我们的在线教育平台分析用户流失问题。
要求：
1. 从用户体验、产品功能、竞争环境三个维度分析
2. 每个维度提供具体的数据支撑和案例
3. 输出格式：问题分析→原因挖掘→改进建议
4. 确保建议具有可操作性和优先级排序
请以SWOT分析框架为基础，同时考虑用户生命周期的不同阶段。`,
            
            2: `Act as a senior marketing strategist with 15 years of experience in digital marketing. Please develop a comprehensive social media strategy for a new sustainable fashion brand.
Requirements:
1. Target audience: Environmentally conscious millennials and Gen Z
2. Budget: $50,000 for 6 months
3. Goals: Increase brand awareness by 40% and drive 25% sales growth
4. Platforms: Focus on Instagram, TikTok, and Pinterest
Deliverables:
- Content calendar with specific post types and frequency
- Influencer collaboration strategy
- Paid advertising recommendations with budget allocation
- KPIs and measurement framework
Please structure your response as: Situation Analysis → Strategy Framework → Tactical Execution → Success Metrics.`,
            
            3: `マーケティングの専門家として、新しいAI搭載のスマートウォッチの商品戦略を立案してください。
背景情報：
- ターゲット：健康志向の30-50代ビジネスパーソン
- 予算：マーケティング費用1億円（1年間）
- 競合：Apple Watch、Fitbit、Garmin
- 独自機能：ストレス検知とメンタルヘルス管理
要求事項：
1. 市場分析（競合比較を含む）
2. ポジショニング戦略
3. 4P戦略（Product, Price, Place, Promotion）
4. ローンチ計画（6ヶ月のタイムライン）
5. 成功指標とKPI設定
SWOT分析フレームワークを使用して、構造化された提案書を作成してください。各セクションには具体的な数値目標と実施可能なアクションプランを含めること。`
        };
        // 提示词配方解析器相关函数
        function showAnalyzer() {
            document.getElementById('analyzerModal').classList.remove('hidden');
        }
        function closeAnalyzer() {
            document.getElementById('analyzerModal').classList.add('hidden');
            // 保留分析结果，不重置
        }
        function loadExample(exampleNum) {
            document.getElementById('promptInput').value = excellentPrompts[exampleNum];
        }
        async function analyzePrompt() {
            const promptText = document.getElementById('promptInput').value.trim();
            if (!promptText) {
                showCustomAlert('请先输入要分析的提示词');
                return;
            }
            // 隐藏之前的结果
            document.getElementById('analysisResult').classList.add('hidden');
            document.getElementById('effectPrediction').classList.add('hidden');
            document.getElementById('inspirationSuggestions').classList.add('hidden');
            document.getElementById('optimizationSuggestions').classList.add('hidden');
            
            // 移除之前的下载按钮
            const existingBtn = document.getElementById('analyzerDownloadBtn');
            if (existingBtn) existingBtn.remove();
            // 显示进度条并开始分析
            showProgressWithSteps('analysisProgress', [
                { text: '检测语言和结构...', duration: 800 },
                { text: '识别提示词配方...', duration: 1000 },
                { text: '调用AI深度分析...', duration: 2000 },
                { text: '生成优化建议...', duration: 1200 },
                { text: '分析完成！', duration: 300 }
            ], async () => {
                try {
                    // 本地分析提示词配方
                    const localAnalysis = analyzePromptComposition(promptText);
                    
                    // 使用AI进行深度分析
                    const aiAnalysisPrompt = `作为提示词工程专家，请深度分析以下提示词：
${promptText}
请从以下维度进行专业分析：
1. 结构完整性：角色设定、任务描述、输出要求等要素是否齐全
2. 逻辑严密性：指令逻辑是否清晰，是否存在歧义或矛盾
3. 可操作性：指令是否具体可执行，AI能否准确理解并执行
4. 效果预测：预测这个提示词的实际效果和可能的问题
5. 优化建议：提供3-5个具体的改进建议
请提供ONLY JSON格式的分析结果，格式如下：
{
  "structureScore": 85,
  "logicScore": 90,
  "operabilityScore": 80,
  "overallScore": 85,
  "strengths": ["优点1", "优点2"],
  "weaknesses": ["问题1", "问题2"],
  "suggestions": ["建议1", "建议2", "建议3"],
  "effectPrediction": "效果预测描述"
}`;
                    let aiAnalysis = null;
                    try {
                        const aiResult = await callAI(aiAnalysisPrompt, { temperature: 0.3, maxTokens: 1500 });
                        if (aiResult.success) {
                            // 尝试解析AI返回的JSON
                            const jsonMatch = aiResult.response.match(/\{[\s\S]*\}/);
                            if (jsonMatch) {
                                aiAnalysis = JSON.parse(jsonMatch[0]);
                            }
                        }
                    } catch (error) {
                        console.warn('AI分析失败，使用本地分析:', error);
                    }
                    
                    // 合并本地分析和AI分析
                    const finalAnalysis = mergeAnalysisResults(localAnalysis, aiAnalysis);
                    
                    // 保存到历史记录
                    saveToHistory('analyzer', promptText, finalAnalysis);
                    
                    // 显示分析结果
                    displayAnalysisResults(finalAnalysis);
                    displayEffectPrediction(finalAnalysis);
                    displayInspirationSuggestions(finalAnalysis);
                    displayOptimizationSuggestions(finalAnalysis);
                    
                    // 添加下载按钮
                    setTimeout(() => {
                        addDownloadButton('analyzer', promptText, finalAnalysis);
                    }, 500);
                    
                } catch (error) {
                    console.error('分析过程出错:', error);
                    showCustomAlert(`分析失败: ${error.message}`);
                    
                    // 显示错误状态并提供重试选项
                    updateProgress('analysisProgress', 100, '分析失败', 'error');
                }
            });
        }
        function mergeAnalysisResults(localAnalysis, aiAnalysis) {
            const merged = { ...localAnalysis };
            
            if (aiAnalysis) {
                // 合并AI分析的评分
                if (aiAnalysis.overallScore) {
                    merged.aiScore = aiAnalysis.overallScore;
                    merged.strengthScore.ai_evaluation = aiAnalysis.overallScore;
                }
                
                // 合并AI的优势和弱点分析
                if (aiAnalysis.strengths) {
                    merged.aiStrengths = aiAnalysis.strengths;
                }
                if (aiAnalysis.weaknesses) {
                    merged.aiWeaknesses = aiAnalysis.weaknesses;
                }
                if (aiAnalysis.suggestions) {
                    merged.aiSuggestions = aiAnalysis.suggestions;
                }
                if (aiAnalysis.effectPrediction) {
                    merged.aiEffectPrediction = aiAnalysis.effectPrediction;
                }
                
                // 调整总分，融合AI评分
                if (aiAnalysis.overallScore) {
                    merged.strengthScore.total = Math.round((merged.strengthScore.total + aiAnalysis.overallScore) / 2);
                }
            }
            
            return merged;
        }
        function createSimpleProgressBar() {
            const container = document.querySelector('#analyzerModal .grid');
            const progressDiv = document.createElement('div');
            progressDiv.id = 'analysisProgress';
            progressDiv.className = 'bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4';
            progressDiv.innerHTML = `
                <div class="flex items-center mb-2">
                    <span class="mr-2">🔄</span>
                    <span class="font-medium text-blue-900 dark:text-blue-300">正在分析提示词...</span>
                </div>
                <div class="w-full bg-blue-200 dark:bg-blue-700 rounded-full h-2">
                    <div id="progressBarFill" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div id="progressText" class="text-sm text-blue-700 dark:text-blue-300 mt-2">初始化中...</div>
            `;
            container.insertBefore(progressDiv, container.firstChild);
        }
        function simulateAnalysisProgress(onComplete) {
            const steps = [
                { text: '检测语言和结构...', width: 20 },
                { text: '识别提示词配方...', width: 50 },
                { text: '评估效果预测...', width: 75 },
                { text: '生成优化建议...', width: 90 },
                { text: '分析完成！', width: 100 }
            ];
            
            let currentStep = 0;
            
            function nextStep() {
                if (currentStep >= steps.length) {
                    setTimeout(onComplete, 500);
                    return;
                }
                
                const step = steps[currentStep];
                const progressBar = document.getElementById('progressBarFill');
                const progressText = document.getElementById('progressText');
                
                if (progressBar && progressText) {
                    progressBar.style.width = step.width + '%';
                    progressText.textContent = step.text;
                }
                
                currentStep++;
                setTimeout(nextStep, 800);
            }
            
            nextStep();
        }
        function removeProgressBar() {
            const progressDiv = document.getElementById('analysisProgress');
            if (progressDiv) {
                progressDiv.remove();
            }
        }
        function saveAnalysisToHistory(promptText, analysis) {
            if (!window.analysisHistory) {
                window.analysisHistory = [];
            }
            
            const record = {
                id: Date.now(),
                timestamp: new Date().toLocaleString('zh-CN'),
                prompt: promptText,
                analysis: analysis
            };
            
            window.analysisHistory.unshift(record);
            
            // 保持最多5条记录
            if (window.analysisHistory.length > 5) {
                window.analysisHistory = window.analysisHistory.slice(0, 5);
            }
            
            updateHistoryDisplay();
        }
        function updateHistoryDisplay() {
            if (!window.analysisHistory || window.analysisHistory.length === 0) return;
            
            const container = document.querySelector('#analyzerModal .p-6');
            let historyDiv = document.getElementById('historySection');
            
            if (!historyDiv) {
                historyDiv = document.createElement('div');
                historyDiv.id = 'historySection';
                historyDiv.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4';
                container.insertBefore(historyDiv, container.firstChild);
            }
            
            historyDiv.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-gray-900 dark:text-white">📚 分析历史</h4>
                    <button onclick="clearAnalysisHistory()" class="text-xs text-red-500 hover:text-red-700">清空</button>
                </div>
                <div class="space-y-2 max-h-24 overflow-y-auto">
                    ${window.analysisHistory.map(record => `
                        <div class="flex items-center justify-between p-2 bg-white dark:bg-gray-600 rounded text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-500"
                             onclick="loadHistoryRecord(${record.id})">
                            <span class="flex-1 truncate">${record.prompt.substring(0, 30)}...</span>
                            <span class="text-xs text-gray-500">${record.timestamp.split(' ')[1]}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        function loadHistoryRecord(id) {
            const record = window.analysisHistory.find(r => r.id === id);
            if (!record) return;
            
            document.getElementById('promptInput').value = record.prompt;
            displayAnalysisResults(record.analysis);
            displayEffectPrediction(record.analysis);
            displayInspirationSuggestions(record.analysis);
            displayOptimizationSuggestions(record.analysis);
            addAnalyzerDownloadButton(record.prompt, record.analysis);
            
            showCustomAlert('历史记录已加载！');
        }
        function clearAnalysisHistory() {
            window.analysisHistory = [];
            const historyDiv = document.getElementById('historySection');
            if (historyDiv) {
                historyDiv.remove();
            }
        }
        function addAnalyzerDownloadButton(promptText, analysis) {
            // 移除之前的下载按钮
            const existingBtn = document.getElementById('analyzerDownloadBtn');
            if (existingBtn) existingBtn.remove();
            
            // 在优化建议区域添加下载按钮
            const container = document.getElementById('optimizationSuggestions');
            if (!container || container.classList.contains('hidden')) return;
            
            const downloadBtn = document.createElement('div');
            downloadBtn.id = 'analyzerDownloadBtn';
            downloadBtn.className = 'mt-4 text-center';
            downloadBtn.innerHTML = `
                <button onclick="downloadAnalysisReport('${promptText.replace(/'/g, "\\'")}', '${JSON.stringify(analysis).replace(/'/g, "\\'")}')" 
                        class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all duration-200 inline-flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    下载分析报告
                </button>
            `;
            container.appendChild(downloadBtn);
        }
        function downloadAnalysisReport(promptText, analysisJson) {
            try {
                const analysis = JSON.parse(analysisJson);
                const timestamp = new Date().toLocaleString('zh-CN');
                
                const reportContent = `# 提示词配方解析报告
生成时间：${timestamp}
## 原始提示词
\`\`\`
${promptText}
\`\`\`
## 分析结果
### 识别的操作方法
${analysis.identifiedMethods.map((method, index) => `
${index + 1}. **${method.method}** (${method.category})
   - 置信度: ${method.confidence}%
   - 证据: ${method.evidence}
`).join('')}
### 质量评分
- 总分: ${analysis.strengthScore.total}/100
- 详细分解: ${Object.entries(analysis.strengthScore.breakdown).map(([item, score]) => `${item}: ${score}分`).join(', ')}
### 复杂度分析
- 涉及分类: ${analysis.categories.length}个
- 方法数量: ${analysis.complexity}个
- 提示词长度: ${analysis.promptLength}字符
---
*本报告由提示词配方解析器自动生成*`;
                const blob = new Blob([reportContent], { type: 'text/markdown;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `提示词分析报告_${new Date().toISOString().slice(0, 10)}.md`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showCustomAlert('报告下载成功！');
            } catch (error) {
                showCustomAlert('下载失败，请重试');
            }
        }
        // 多语言关键词库
        const multiLangKeywords = {
            role_setting: {
                zh: ['你是', '扮演', '作为', '假设你是', '请以', '身份'],
                en: ['you are', 'act as', 'assume you are', 'pretend to be', 'as a', 'role of', 'imagine you are'],
                ja: ['あなたは', 'として', '役割', 'の立場で', 'という設定'],
                ko: ['당신은', '역할을', '로서', '가정하고'],
                fr: ['vous êtes', 'en tant que', 'jouez le rôle', 'supposons que vous êtes'],
                de: ['sie sind', 'als', 'stellen sie sich vor', 'nehmen sie die rolle'],
                es: ['usted es', 'actúe como', 'asuma que es', 'imagine que es']
            },
            task_breakdown: {
                zh: ['要求：', '步骤', '第一', '第二', '1.', '2.', '3.', '首先', '然后', '最后'],
                en: ['requirements:', 'steps', 'first', 'second', 'then', 'next', 'finally', '1.', '2.', '3.'],
                ja: ['要求：', 'ステップ', '最初に', '次に', '最後に', '1.', '2.', '3.'],
                ko: ['요구사항:', '단계', '첫째', '둘째', '셋째', '먼저', '다음', '마지막'],
                fr: ['exigences:', 'étapes', 'premièrement', 'deuxièmement', 'ensuite', 'finalement'],
                de: ['anforderungen:', 'schritte', 'erstens', 'zweitens', 'dann', 'schließlich'],
                es: ['requisitos:', 'pasos', 'primero', 'segundo', 'luego', 'finalmente']
            },
            format_constraint: {
                zh: ['格式', '输出', '按照', '→', '格式要求', '结构'],
                en: ['format', 'output', 'structure', 'according to', '→', 'in the format'],
                ja: ['フォーマット', '出力', '形式', '構造', '→'],
                ko: ['형식', '출력', '구조', '→', '포맷'],
                fr: ['format', 'sortie', 'structure', 'selon', '→'],
                de: ['format', 'ausgabe', 'struktur', 'gemäß', '→'],
                es: ['formato', 'salida', 'estructura', 'según', '→']
            },
            professional_level: {
                zh: ['专业', '经验', '资深', '专家', '高级', '熟练'],
                en: ['professional', 'expert', 'experienced', 'senior', 'skilled', 'advanced'],
                ja: ['専門', '経験', 'ベテラン', '専門家', '上級', '熟練'],
                ko: ['전문', '경험', '숙련된', '전문가', '고급', '베테랑'],
                fr: ['professionnel', 'expert', 'expérimenté', 'senior', 'qualifié'],
                de: ['professionell', 'experte', 'erfahren', 'senior', 'qualifiziert'],
                es: ['profesional', 'experto', 'experimentado', 'senior', 'calificado']
            },
            concrete_examples: {
                zh: ['案例', '例子', '具体', '比如', '举例', '示例'],
                en: ['case', 'example', 'specific', 'for instance', 'such as', 'concrete'],
                ja: ['事例', '例', '具体的', 'たとえば', '例えば'],
                ko: ['사례', '예시', '구체적', '예를 들어', '구체적으로'],
                fr: ['cas', 'exemple', 'spécifique', 'par exemple', 'concret'],
                de: ['fall', 'beispiel', 'spezifisch', 'zum beispiel', 'konkret'],
                es: ['caso', 'ejemplo', 'específico', 'por ejemplo', 'concreto']
            },
            negative_constraints: {
                zh: ['不要', '避免', '禁止', '不能', '不可以', '不应该'],
                en: ['do not', 'avoid', 'don\'t', 'never', 'refrain from', 'exclude'],
                ja: ['してはいけない', '避ける', '禁止', 'しないで', 'だめ'],
                ko: ['하지 마', '피하다', '금지', '안 된다', '하면 안 돼'],
                fr: ['ne pas', 'éviter', 'interdire', 'ne jamais', 's\'abstenir'],
                de: ['nicht', 'vermeiden', 'verbieten', 'niemals', 'unterlassen'],
                es: ['no', 'evitar', 'prohibir', 'nunca', 'abstenerse']
            },
            length_constraints: {
                zh: ['字数', '段落', '控制在', '不超过', '限制', '字符'],
                en: ['words', 'characters', 'limit', 'no more than', 'within', 'paragraphs'],
                ja: ['文字数', '段落', '制限', '以内', '文字制限'],
                ko: ['글자 수', '단락', '제한', '이내', '문자 제한'],
                fr: ['mots', 'caractères', 'limite', 'pas plus de', 'dans'],
                de: ['wörter', 'zeichen', 'grenze', 'nicht mehr als', 'innerhalb'],
                es: ['palabras', 'caracteres', 'límite', 'no más de', 'dentro']
            },
            background_context: {
                zh: ['背景', '情况', '环境', '前提', '基于', '考虑到'],
                en: ['background', 'context', 'situation', 'given', 'based on', 'considering'],
                ja: ['背景', '状況', '環境', '前提', 'を踏まえて', '考慮して'],
                ko: ['배경', '상황', '환경', '전제', '바탕으로', '고려하여'],
                fr: ['contexte', 'situation', 'environnement', 'étant donné', 'basé sur'],
                de: ['hintergrund', 'kontext', 'situation', 'gegeben', 'basierend auf'],
                es: ['antecedentes', 'contexto', 'situación', 'dado', 'basado en']
            },
            scenario_setting: {
                zh: ['假设', '场景', '情境', '在...中', '设想', '模拟'],
                en: ['assume', 'scenario', 'situation', 'imagine', 'suppose', 'simulate'],
                ja: ['仮定', 'シナリオ', '状況', '想像', 'とする', 'シミュレート'],
                ko: ['가정', '시나리오', '상황', '상상', '가정하면', '시뮬레이션'],
                fr: ['supposer', 'scénario', 'situation', 'imaginer', 'simuler'],
                de: ['annehmen', 'szenario', 'situation', 'vorstellen', 'simulieren'],
                es: ['suponer', 'escenario', 'situación', 'imaginar', 'simular']
            },
            frameworks: {
                zh: ['swot', 'pdca', '5w1h', '头脑风暴', '思维导图', '鱼骨图'],
                en: ['swot', 'pdca', '5w1h', 'brainstorm', 'mind map', 'fishbone', 'smart goals'],
                ja: ['swot', 'pdca', '5w1h', 'ブレインストーミング', 'マインドマップ'],
                ko: ['swot', 'pdca', '5w1h', '브레인스토밍', '마인드맵'],
                fr: ['swot', 'pdca', '5w1h', 'brainstorming', 'carte mentale'],
                de: ['swot', 'pdca', '5w1h', 'brainstorming', 'mind map'],
                es: ['swot', 'pdca', '5w1h', 'lluvia de ideas', 'mapa mental']
            },
            engagement_enhancement: {
                zh: ['生动', '有趣', '吸引', '引人入胜', '趣味', '活泼'],
                en: ['engaging', 'interesting', 'compelling', 'captivating', 'vivid', 'lively'],
                ja: ['生き生き', '面白い', '魅力的', '興味深い', '活発'],
                ko: ['생생한', '흥미로운', '매력적인', '재미있는', '활발한'],
                fr: ['engageant', 'intéressant', 'captivant', 'vivant', 'attrayant'],
                de: ['ansprechend', 'interessant', 'fesselnd', 'lebendig', 'attraktiv'],
                es: ['atractivo', 'interesante', 'cautivador', 'vívido', 'animado']
            },
            actionable: {
                zh: ['可操作', '具体步骤', '行动', '实施', '执行', '落地'],
                en: ['actionable', 'specific steps', 'implementation', 'execute', 'practical'],
                ja: ['実行可能', '具体的', 'ステップ', '実施', '実践'],
                ko: ['실행 가능한', '구체적 단계', '실행', '실시', '실용적'],
                fr: ['actionnable', 'étapes spécifiques', 'mise en œuvre', 'exécuter'],
                de: ['umsetzbar', 'spezifische schritte', 'umsetzung', 'ausführen'],
                es: ['accionable', 'pasos específicos', 'implementación', 'ejecutar']
            }
        };
        // 检测文本语言
        function detectLanguage(text) {
            const langScores = {
                zh: 0, en: 0, ja: 0, ko: 0, fr: 0, de: 0, es: 0
            };
            // 基于字符特征检测
            const chineseChars = text.match(/[\u4e00-\u9fff]/g);
            const japaneseChars = text.match(/[\u3040-\u309f\u30a0-\u30ff]/g);
            const koreanChars = text.match(/[\uac00-\ud7af]/g);
            if (chineseChars) langScores.zh += chineseChars.length * 2;
            if (japaneseChars) langScores.ja += japaneseChars.length * 2;
            if (koreanChars) langScores.ko += koreanChars.length * 2;
            // 基于关键词检测
            Object.entries(multiLangKeywords).forEach(([category, languages]) => {
                Object.entries(languages).forEach(([lang, keywords]) => {
                    keywords.forEach(keyword => {
                        if (text.toLowerCase().includes(keyword.toLowerCase())) {
                            langScores[lang] += keyword.length;
                        }
                    });
                });
            });
            // 返回得分最高的语言，如果都很低就默认中文
            const maxScore = Math.max(...Object.values(langScores));
            if (maxScore === 0) return 'zh';
            
            return Object.keys(langScores).find(lang => langScores[lang] === maxScore);
        }
        // 多语言关键词检测
        function containsKeywords(text, keywordCategory, detectedLang) {
            const keywords = multiLangKeywords[keywordCategory];
            if (!keywords) return false;
            // 检查检测到的语言和英语（作为备选）
            const langsToCheck = [detectedLang];
            if (detectedLang !== 'en') langsToCheck.push('en');
            if (detectedLang !== 'zh') langsToCheck.push('zh');
            for (const lang of langsToCheck) {
                if (keywords[lang]) {
                    for (const keyword of keywords[lang]) {
                        if (text.toLowerCase().includes(keyword.toLowerCase())) {
                            return { found: true, keyword, language: lang };
                        }
                    }
                }
            }
            return { found: false };
        }
        function analyzePromptComposition(promptText) {
            const text = promptText.toLowerCase();
            const identifiedMethods = [];
            const strengthScore = { total: 0, breakdown: {} };
            
            // 检测语言
            const detectedLang = detectLanguage(promptText);
            // 检测结构性操作 - 角色设定
            const roleResult = containsKeywords(text, 'role_setting', detectedLang);
            if (roleResult.found) {
                identifiedMethods.push({
                    category: '结构性操作',
                    subCategory: '解构重组',
                    method: '模块化设计',
                    confidence: 90,
                    evidence: `使用了角色设定模块 (${roleResult.language}: "${roleResult.keyword}")`
                });
                strengthScore.breakdown['角色定义'] = 15;
            }
            // 检测任务分解
            const taskResult = containsKeywords(text, 'task_breakdown', detectedLang);
            if (taskResult.found) {
                identifiedMethods.push({
                    category: '结构性操作',
                    subCategory: '解构重组',
                    method: '层级分解',
                    confidence: 85,
                    evidence: `将任务分解为多个步骤 (${taskResult.language}: "${taskResult.keyword}")`
                });
                strengthScore.breakdown['任务分解'] = 20;
            }
            if (text.includes('格式') || text.includes('输出') || text.includes('→')) {
                identifiedMethods.push({
                    category: '约束性操作',
                    subCategory: '硬性约束',
                    method: '格式限定',
                    confidence: 80,
                    evidence: '明确指定了输出格式'
                });
                strengthScore.breakdown['格式规范'] = 10;
            }
            // 检测内容性操作
            if (text.includes('专业') || text.includes('经验') || text.includes('资深')) {
                identifiedMethods.push({
                    category: '内容性操作',
                    subCategory: '信息转换',
                    method: '专业度调节',
                    confidence: 75,
                    evidence: '设定了专业水准要求'
                });
                strengthScore.breakdown['专业水平'] = 15;
            }
            if (text.includes('案例') || text.includes('例子') || text.includes('具体')) {
                identifiedMethods.push({
                    category: '内容性操作',
                    subCategory: '信息转换',
                    method: '抽象度变换',
                    confidence: 70,
                    evidence: '要求提供具体案例支撑'
                });
                strengthScore.breakdown['具体化'] = 10;
            }
            // 检测约束性操作
            if (text.includes('不要') || text.includes('避免') || text.includes('禁止')) {
                identifiedMethods.push({
                    category: '约束性操作',
                    subCategory: '否定约束',
                    method: '禁止项列举',
                    confidence: 85,
                    evidence: '明确了禁止事项'
                });
                strengthScore.breakdown['边界控制'] = 10;
            }
            if (text.includes('字数') || text.includes('段落') || text.includes('控制在')) {
                identifiedMethods.push({
                    category: '约束性操作',
                    subCategory: '硬性约束',
                    method: '长度限制',
                    confidence: 90,
                    evidence: '设置了长度限制'
                });
                strengthScore.breakdown['长度控制'] = 8;
            }
            // 检测上下文操作
            if (text.includes('背景') || text.includes('情况') || text.includes('环境')) {
                identifiedMethods.push({
                    category: '上下文操作',
                    subCategory: '知识背景',
                    method: '语境植入',
                    confidence: 75,
                    evidence: '提供了背景信息'
                });
                strengthScore.breakdown['语境设定'] = 12;
            }
            if (text.includes('假设') || text.includes('场景') || text.includes('情境')) {
                identifiedMethods.push({
                    category: '上下文操作',
                    subCategory: '情境营造',
                    method: '场景描述',
                    confidence: 80,
                    evidence: '创建了具体场景'
                });
                strengthScore.breakdown['情境营造'] = 15;
            }
            // 检测框架应用
            const frameworks = ['swot', 'pdca', '5w1h', '头脑风暴', '思维导图'];
            frameworks.forEach(framework => {
                if (text.includes(framework)) {
                    identifiedMethods.push({
                        category: '结构性操作',
                        subCategory: '框架应用',
                        method: '框架套用',
                        confidence: 95,
                        evidence: `使用了${framework.toUpperCase()}框架`
                    });
                    strengthScore.breakdown['框架运用'] = 20;
                }
            });
            // 检测效果增强操作
            if (text.includes('生动') || text.includes('有趣') || text.includes('吸引')) {
                identifiedMethods.push({
                    category: '效果增强操作',
                    subCategory: '情感增强',
                    method: '趣味注入',
                    confidence: 70,
                    evidence: '要求增强趣味性'
                });
                strengthScore.breakdown['趣味性'] = 10;
            }
            if (text.includes('可操作') || text.includes('具体步骤') || text.includes('行动')) {
                identifiedMethods.push({
                    category: '效果增强操作',
                    subCategory: '实用增强',
                    method: '可操作性',
                    confidence: 85,
                    evidence: '强调可操作性'
                });
                strengthScore.breakdown['可操作性'] = 15;
            }
            // 计算总分
            strengthScore.total = Object.values(strengthScore.breakdown).reduce((sum, score) => sum + score, 0);
            return {
                identifiedMethods,
                strengthScore,
                promptLength: promptText.length,
                complexity: identifiedMethods.length,
                categories: [...new Set(identifiedMethods.map(m => m.category))]
            };
        }
        function displayAnalysisResults(analysis) {
            const container = document.getElementById('ingredientsList');
            const categories = {};
            
            // 按分类组织方法
            analysis.identifiedMethods.forEach(method => {
                if (!categories[method.category]) {
                    categories[method.category] = [];
                }
                categories[method.category].push(method);
            });
            let html = '';
            Object.entries(categories).forEach(([category, methods]) => {
                const categoryData = methodsDatabase[category];
                const levelInfo = levelConfig[categoryData?.level || 'basic'];
                
                html += `
                    <div class="mb-4">
                        <div class="flex items-center mb-2">
                            <span class="text-lg mr-2">${categoryData?.icon || '📋'}</span>
                            <span class="font-medium text-green-900 dark:text-green-300">${category}</span>
                            <span class="level-badge ${levelInfo.color} ml-2 text-xs">${levelInfo.name.slice(2)}</span>
                        </div>
                        <div class="space-y-2 ml-6">
                            ${methods.map(method => `
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 border border-green-200 dark:border-green-700">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <span class="font-medium text-gray-900 dark:text-white">${method.method}</span>
                                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${method.evidence}</p>
                                        </div>
                                        <div class="flex items-center">
                                            <div class="w-12 h-2 bg-gray-200 dark:bg-gray-600 rounded-full mr-2">
                                                <div class="h-full bg-green-500 rounded-full" style="width: ${method.confidence}%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">${method.confidence}%</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
            document.getElementById('analysisResult').classList.remove('hidden');
        }
        function displayEffectPrediction(analysis) {
            const container = document.getElementById('predictionContent');
            const score = analysis.strengthScore.total;
            let level, color, description;
            if (score >= 80) {
                level = '优秀';
                color = 'text-green-600';
                description = '这是一个结构完整、要素齐全的优秀提示词';
            } else if (score >= 60) {
                level = '良好';
                color = 'text-blue-600';
                description = '提示词质量良好，还有进一步优化空间';
            } else if (score >= 40) {
                level = '一般';
                color = 'text-yellow-600';
                description = '提示词基本可用，但缺少一些关键要素';
            } else {
                level = '需改进';
                color = 'text-red-600';
                description = '提示词需要大幅改进才能获得理想效果';
            }
            const html = `
                <div class="space-y-4">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-yellow-200 dark:border-yellow-700">
                        <div class="flex justify-between items-center mb-3">
                            <h5 class="font-medium text-gray-900 dark:text-white">综合质量评分</h5>
                            <span class="text-2xl font-bold ${color}">${score}/100</span>
                        </div>
                        <div class="w-full h-3 bg-gray-200 dark:bg-gray-600 rounded-full mb-2">
                            <div class="h-full bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 rounded-full" style="width: ${Math.min(score, 100)}%"></div>
                        </div>
                        <p class="text-sm ${color} font-medium">${level} - ${description}</p>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-yellow-200 dark:border-yellow-700">
                        <h5 class="font-medium text-gray-900 dark:text-white mb-3">详细评分分解</h5>
                        <div class="space-y-2">
                            ${Object.entries(analysis.strengthScore.breakdown).map(([item, score]) => `
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">${item}</span>
                                    <div class="flex items-center">
                                        <div class="w-20 h-2 bg-gray-200 dark:bg-gray-600 rounded-full mr-2">
                                            <div class="h-full bg-blue-500 rounded-full" style="width: ${(score/20)*100}%"></div>
                                        </div>
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">${score}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-yellow-200 dark:border-yellow-700">
                        <h5 class="font-medium text-gray-900 dark:text-white mb-3">复杂度分析</h5>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <div class="text-xl font-bold text-gray-900 dark:text-white">${analysis.categories.length}</div>
                                <div class="text-xs text-gray-500">涉及分类</div>
                            </div>
                            <div>
                                <div class="text-xl font-bold text-gray-900 dark:text-white">${analysis.complexity}</div>
                                <div class="text-xs text-gray-500">方法数量</div>
                            </div>
                            <div>
                                <div class="text-xl font-bold text-gray-900 dark:text-white">${Math.round(analysis.promptLength/100)}</div>
                                <div class="text-xs text-gray-500">百字复杂度</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
            document.getElementById('effectPrediction').classList.remove('hidden');
        }
        function displayInspirationSuggestions(analysis) {
            const container = document.getElementById('inspirationContent');
            const usedCategories = analysis.categories;
            const allCategories = Object.keys(methodsDatabase);
            const missingCategories = allCategories.filter(cat => !usedCategories.includes(cat));
            const inspirations = [];
            // 基于已用方法的举一反三
            if (usedCategories.includes('结构性操作')) {
                inspirations.push({
                    type: '增强现有',
                    title: '结构性操作深化',
                    suggestion: '你已经用了角色设定和任务分解，可以尝试添加"递归深化"：让AI在每个分析维度上再次深入挖掘，形成多层次分析。',
                    example: '在每个维度分析后，加入：\n"请对上述每个要点进一步深入分析其根本原因和潜在影响"'
                });
            }
            // 基于缺失方法的建议
            if (!usedCategories.includes('本体性操作')) {
                inspirations.push({
                    type: '添加新维度',
                    title: '本体性思维升级',
                    suggestion: '尝试重新定义问题的本质：不是"分析用户流失"，而是"重新定义用户与产品的关系"，从根本上改变问题的认知框架。',
                    example: '加入：\n"请重新定义用户流失问题的本质：用户流失是关系断裂还是价值错配？基于这个新定义重新分析。"'
                });
            }
            if (!usedCategories.includes('过程性操作')) {
                inspirations.push({
                    type: '流程优化',
                    title: '过程性操作引入',
                    suggestion: '设计迭代优化流程：让AI先给出初步分析，然后基于反馈不断优化，而不是一次性输出。',
                    example: '加入：\n"请先给出框架性分析，然后我会针对每个部分提出问题，你再深入展开对应部分。"'
                });
            }
            // 组合创新建议
            inspirations.push({
                type: '组合创新',
                title: '跨类别组合',
                suggestion: '结合"情境营造"+"本体性思维"：将分析放在具体的危机场景中，同时重新定义"危机"的本质含义。',
                example: '情境设定：\n"假设你是在董事会紧急会议上，需要在30分钟内给出解决方案。同时，请将用户流失重新定义为生态系统的自然调节过程。"'
            });
            const html = `
                <div class="space-y-4">
                    ${inspirations.map((inspiration, index) => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-orange-200 dark:border-orange-700">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0 w-8 h-8 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">
                                    <span class="text-orange-600 dark:text-orange-400 font-bold text-sm">${index + 1}</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 text-xs rounded">${inspiration.type}</span>
                                        <h6 class="font-medium text-gray-900 dark:text-white">${inspiration.title}</h6>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">${inspiration.suggestion}</p>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">💡 实践示例：</div>
                                        <code class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-line">${inspiration.example}</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.innerHTML = html;
            document.getElementById('inspirationSuggestions').classList.remove('hidden');
        }
        function displayOptimizationSuggestions(analysis) {
            const container = document.getElementById('suggestionContent');
            const suggestions = [];
            // 基于分数给出建议
            if (analysis.strengthScore.total < 60) {
                suggestions.push({
                    priority: '高',
                    title: '补充关键要素',
                    content: '当前提示词缺少一些基础要素，建议补充：明确的角色定义、清晰的输出格式要求、具体的质量标准。'
                });
            }
            if (!analysis.strengthScore.breakdown['边界控制']) {
                suggestions.push({
                    priority: '中',
                    title: '增加约束条件',
                    content: '建议添加否定约束，明确告诉AI什么不要做，比如"不要使用过于学术化的语言"或"避免空洞的套话"。'
                });
            }
            if (analysis.promptLength < 200) {
                suggestions.push({
                    priority: '中',
                    title: '丰富上下文信息',
                    content: '提示词相对较短，可以添加更多背景信息和具体要求，帮助AI更好地理解任务场景。'
                });
            }
            if (analysis.categories.length < 3) {
                suggestions.push({
                    priority: '低',
                    title: '增加操作维度',
                    content: '当前主要使用了少数几个操作类别，可以尝试引入更多维度，如情境营造、效果增强等，丰富提示词的层次。'
                });
            }
            const html = `
                <div class="space-y-3">
                    ${suggestions.map(suggestion => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-blue-200 dark:border-blue-700">
                            <div class="flex items-start space-x-3">
                                <span class="px-2 py-1 text-xs rounded font-medium ${
                                    suggestion.priority === '高' ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300' :
                                    suggestion.priority === '中' ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300' :
                                    'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300'
                                }">
                                    ${suggestion.priority}优先级
                                </span>
                                <div class="flex-1">
                                    <h6 class="font-medium text-gray-900 dark:text-white mb-1">${suggestion.title}</h6>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">${suggestion.content}</p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.innerHTML = html;
            document.getElementById('optimizationSuggestions').classList.remove('hidden');
        }
        function showCustomAlert(message) {
            // 创建自定义弹窗
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded" onclick="this.closest('.fixed').remove()">确定</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        // ==================== 历史记录管理系统 ====================
        let moduleHistory = {
            analyzer: [],
            smart: [],
            trinity: []
        };
        function saveToHistory(moduleType, input, result) {
            const timestamp = new Date().toISOString();
            const record = {
                id: Date.now(),
                timestamp,
                input,
                result,
                moduleType
            };
            
            moduleHistory[moduleType].unshift(record);
            
            // 保持最多10条记录
            if (moduleHistory[moduleType].length > 10) {
                moduleHistory[moduleType] = moduleHistory[moduleType].slice(0, 10);
            }
            
            updateHistoryUI(moduleType);
        }
        function updateHistoryUI(moduleType) {
            const histories = moduleHistory[moduleType];
            if (histories.length === 0) return;
            
            const containerMaps = {
                analyzer: '#analyzerModal .p-6',
                smart: '#smartHelperModal .p-6',
                trinity: '#trinityModal .p-6'
            };
            
            const container = document.querySelector(containerMaps[moduleType]);
            if (!container) return;
            
            // 检查是否已有历史记录容器
            let historyContainer = container.querySelector('.history-container');
            if (!historyContainer) {
                historyContainer = document.createElement('div');
                historyContainer.className = 'history-container bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 mb-6';
                historyContainer.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white flex items-center">
                            <span class="mr-2">📚</span>
                            历史记录
                        </h4>
                        <button onclick="clearHistory('${moduleType}')" class="text-xs text-red-500 hover:text-red-700">
                            清空记录
                        </button>
                    </div>
                    <div class="history-list space-y-2 max-h-32 overflow-y-auto"></div>
                `;
                container.insertBefore(historyContainer, container.firstChild);
            }
            
            const historyList = historyContainer.querySelector('.history-list');
            historyList.innerHTML = histories.map((record, index) => {
                const shortInput = record.input.substring(0, 30) + (record.input.length > 30 ? '...' : '');
                const timeStr = new Date(record.timestamp).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="flex items-center justify-between p-2 bg-white dark:bg-gray-800 rounded border cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700"
                         onclick="loadHistory('${moduleType}', ${record.id})">
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-900 dark:text-white">${shortInput}</div>
                            <div class="text-xs text-gray-500">${timeStr}</div>
                        </div>
                        <button onclick="deleteHistory('${moduleType}', ${record.id}); event.stopPropagation();" 
                                class="text-xs text-red-400 hover:text-red-600 px-2">删除</button>
                    </div>
                `;
            }).join('');
        }
        function loadHistory(moduleType, recordId) {
            const history = moduleHistory[moduleType].find(record => record.id === recordId);
            if (!history) return;
            
            switch (moduleType) {
                case 'analyzer':
                    document.getElementById('promptInput').value = history.input;
                    if (history.result) {
                        displayAnalysisResults(history.result);
                        displayEffectPrediction(history.result);
                        displayInspirationSuggestions(history.result);
                        displayOptimizationSuggestions(history.result);
                        setTimeout(() => addDownloadButton('analyzer', history.input, history.result), 500);
                    }
                    break;
                    
                case 'smart':
                    document.getElementById('quickInput').value = history.input;
                    if (history.result) {
                        showQuickResult(history.input, history.result.analysis, history.result.optimizedPrompt);
                        setTimeout(() => addDownloadButton('smart', history.input, history.result), 500);
                    }
                    break;
                    
                case 'trinity':
                    document.getElementById('trinityTaskInput').value = history.input;
                    if (history.result && history.result.prompt) {
                        displayFinalTrinityPrompt(history.result.prompt, history.result.analysis, history.result.config);
                        setTimeout(() => addDownloadButton('trinity', history.input, history.result), 500);
                    }
                    break;
            }
            
            showCustomAlert('历史记录已加载！');
        }
        function deleteHistoryRecord(moduleType, recordId) {
            moduleHistory[moduleType] = moduleHistory[moduleType].filter(record => record.id !== recordId);
            updateHistoryUI(moduleType);
        }
        function clearHistory(moduleType) {
            if (moduleHistory[moduleType].length === 0) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">确定要清空所有历史记录吗？</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">取消</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="confirmClearHistory('${moduleType}'); this.closest('.fixed').remove()">确定</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        function confirmClearHistory(moduleType) {
            moduleHistory[moduleType] = [];
            const containers = document.querySelectorAll('.history-container');
            containers.forEach(container => container.remove());
            showCustomAlert('历史记录已清空！');
        }
        // ==================== AI模型选择器功能 ====================
        let currentAIProvider = 'poe';
        let currentAIModel = 'Claude-Sonnet-4';
        const apiKeys = {};
        function showAIModelSelector() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                                    <span class="mr-3">🎛️</span>
                                    AI模型选择器
                                </h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">选择最适合的AI平台和模型</p>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- POE Platform -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Poe Platform</h4>
                                    <span class="px-2 py-1 text-xs rounded ${typeof window !== 'undefined' && typeof window.Poe !== 'undefined' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300' : 'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400'}">
                                        ${typeof window !== 'undefined' && typeof window.Poe !== 'undefined' ? '✅ 可用' : '⚠️ 未检测到'}
                                    </span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <label class="flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <input type="radio" name="selectedModel" value="poe:Claude-Sonnet-4" checked class="mr-3">
                                        <span class="text-sm text-gray-900 dark:text-white">Claude Sonnet 4</span>
                                    </label>
                                    <label class="flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <input type="radio" name="selectedModel" value="poe:GPT-4o" class="mr-3">
                                        <span class="text-sm text-gray-900 dark:text-white">GPT-4o</span>
                                    </label>
                                    <label class="flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <input type="radio" name="selectedModel" value="poe:Claude-3.5-Sonnet" class="mr-3">
                                        <span class="text-sm text-gray-900 dark:text-white">Claude 3.5 Sonnet</span>
                                    </label>
                                    <label class="flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <input type="radio" name="selectedModel" value="poe:Gemini-2.0-Flash" class="mr-3">
                                        <span class="text-sm text-gray-900 dark:text-white">Gemini 2.0 Flash</span>
                                    </label>
                                </div>
                            </div>
                            <!-- OpenRouter -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">OpenRouter</h4>
                                    <span class="px-2 py-1 text-xs rounded bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300">
                                        🔑 需要API密钥
                                    </span>
                                </div>
                                <div class="mb-4">
                                    <input type="password" id="apiKey_openrouter" placeholder="输入OpenRouter的API密钥" 
                                           class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <label class="flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <input type="radio" name="selectedModel" value="openrouter:anthropic/claude-3.5-sonnet" class="mr-3">
                                        <span class="text-sm text-gray-900 dark:text-white">Claude 3.5 Sonnet</span>
                                    </label>
                                    <label class="flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <input type="radio" name="selectedModel" value="openrouter:openai/gpt-4o" class="mr-3">
                                        <span class="text-sm text-gray-900 dark:text-white">GPT-4o</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-4 mt-6">
                            <button onclick="saveAISelection(); this.closest('.fixed').remove()" 
                                    class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200">
                                保存设置
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200">
                                取消
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        function saveAISelection() {
            const selectedRadio = document.querySelector('input[name="selectedModel"]:checked');
            if (selectedRadio) {
                const [providerId, modelId] = selectedRadio.value.split(':');
                currentAIProvider = providerId;
                currentAIModel = modelId;
                
                // 保存API密钥
                if (providerId !== 'poe') {
                    const keyInput = document.getElementById(`apiKey_${providerId}`);
                    if (keyInput && keyInput.value.trim()) {
                        apiKeys[providerId] = keyInput.value.trim();
                        localStorage.setItem(`ai_api_key_${providerId}`, keyInput.value.trim());
                    }
                }
                
                showCustomAlert(`已选择 ${providerId.toUpperCase()} - ${modelId}`);
            }
        }
        // 真实的AI调用函数
        async function callAI(prompt, options = {}) {
            try {
                if (currentAIProvider === 'poe') {
                    return await callPoeAPI(prompt, options);
                } else {
                    return await callExternalAPI(prompt, options);
                }
            } catch (error) {
                console.error(`AI调用失败 (${currentAIProvider}):`, error);
                throw new Error(`AI调用失败: ${error.message}`);
            }
        }
        async function callPoeAPI(prompt, options = {}) {
            // 检查POE API是否可用
            if (typeof window.Poe === 'undefined' || !window.Poe.sendUserMessage) {
                return simulateAIResponse(prompt, options);
            }
            try {
                const handlerId = 'poe_handler_' + Date.now();
                
                return new Promise((resolve, reject) => {
                    let responseData = '';
                    let isComplete = false;
                    
                    window.Poe.registerHandler(handlerId, (result, context) => {
                        try {
                            if (result.responses && result.responses.length > 0) {
                                const message = result.responses[0];
                                responseData = message.content;
                                
                                if (message.status === 'complete') {
                                    isComplete = true;
                                    resolve({
                                        success: true,
                                        response: responseData,
                                        model: currentAIModel,
                                        provider: 'poe'
                                    });
                                } else if (message.status === 'error') {
                                    reject(new Error(message.statusText || 'POE API错误'));
                                }
                            }
                        } catch (error) {
                            reject(error);
                        }
                    });
                    window.Poe.sendUserMessage(`@${currentAIModel} ${prompt}`, {
                        handler: handlerId,
                        stream: options.stream !== false,
                        openChat: options.openChat !== false,
                        handlerContext: options.context || {}
                    }).catch(reject);
                    setTimeout(() => {
                        if (!isComplete) {
                            reject(new Error('请求超时'));
                        }
                    }, 60000);
                });
                
            } catch (error) {
                console.error('POE API调用错误:', error);
                throw error;
            }
        }
        async function callExternalAPI(prompt, options = {}) {
            const apiKey = apiKeys[currentAIProvider];
            if (!apiKey) {
                throw new Error(`请先配置 ${currentAIProvider.toUpperCase()} 的API密钥`);
            }
            
            const requestTimeout = options.timeout || 30000;
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), requestTimeout);
            
            try {
                let url, headers, requestBody;
                
                if (currentAIProvider === 'openrouter') {
                    url = 'https://openrouter.ai/api/v1/chat/completions';
                    headers = {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': '智能提示词工作台'
                    };
                    requestBody = {
                        model: currentAIModel,
                        messages: [{ role: 'user', content: prompt }],
                        temperature: options.temperature || 0.7,
                        max_tokens: options.maxTokens || 2000
                    };
                }
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify(requestBody),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return {
                        success: true,
                        response: data.choices[0].message.content,
                        model: currentAIModel,
                        provider: currentAIProvider,
                        usage: data.usage || null
                    };
                } else {
                    throw new Error('API返回格式异常');
                }
                
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('请求超时');
                }
                throw error;
            }
        }
        function simulateAIResponse(prompt, options = {}) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const analysisType = prompt.toLowerCase();
                    let response = '';
                    
                    if (analysisType.includes('分析') || analysisType.includes('解析')) {
                        response = `基于${currentAIModel}的分析结果：
这个提示词展现了以下特点：
1. **结构完整性**: 具备清晰的角色设定和任务描述
2. **约束明确**: 设定了具体的输出格式和质量要求  
3. **上下文丰富**: 提供了充分的背景信息
4. **可操作性强**: 给出了具体的执行步骤
**优化建议**:
- 可以增加更多的否定约束
- 建议添加具体的案例要求
- 考虑设定评估标准
这是一个质量较高的提示词，评分约为 85/100。`;
                    } else if (analysisType.includes('生成') || analysisType.includes('创建')) {
                        response = `# 优化后的提示词
基于您的需求，我为您生成了以下优化提示词：
## 角色设定
您将作为一位资深的[领域]专家，具备丰富的实践经验和深度的理论基础。
## 任务目标
${prompt.replace(/生成|创建|请/, '').trim()}
## 执行步骤
1. **需求理解**: 深入分析具体需求和期望
2. **方案设计**: 制定系统性的解决方案
3. **细节完善**: 确保方案的可操作性
4. **质量检验**: 验证方案的有效性
## 输出要求
- 结构清晰，逻辑严密
- 具备强可操作性
- 提供具体的实施建议
- 包含风险评估和应对策略
请确保输出内容专业、实用、符合实际应用场景。`;
                    } else {
                        response = `根据${currentAIModel}分析，针对您的需求：
${prompt}
这个任务需要综合考虑多个维度：
- 技术可行性
- 实施复杂度  
- 预期效果
- 资源投入
建议采用渐进式方法，先从核心功能开始，逐步完善和优化。
如需更详细的分析，请提供更多具体信息。`;
                    }
                    
                    resolve({
                        success: true,
                        response: response,
                        model: currentAIModel,
                        provider: currentAIProvider,
                        simulated: true
                    });
                }, 1500 + Math.random() * 2000);
            });
        }
        // 初始化API密钥
        function initializeStoredKeys() {
            ['openrouter', 'groq', 'gemini'].forEach(provider => {
                const savedKey = localStorage.getItem(`ai_api_key_${provider}`);
                if (savedKey) {
                    apiKeys[provider] = savedKey;
                }
            });
        }
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            initializeStoredKeys();
        });
        // 点击模态框背景关闭
        document.getElementById('methodModal').addEventListener('click', (e) => {
            if (e.target.id === 'methodModal') {
                closeModal();
            }
        });
        document.getElementById('analyzerModal').addEventListener('click', (e) => {
            if (e.target.id === 'analyzerModal') {
                closeAnalyzer();
            }
        });
        document.getElementById('smartHelperModal').addEventListener('click', (e) => {
            if (e.target.id === 'smartHelperModal') {
                closeSmartHelper();
            }
        });
        // 智能提示词助手相关函数
        function showSmartHelper() {
            document.getElementById('smartHelperModal').classList.remove('hidden');
        }
        function closeSmartHelper() {
            document.getElementById('smartHelperModal').classList.add('hidden');
            document.getElementById('modeDetails').classList.add('hidden');
            // 重置模式选择
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-green-400', 'ring-blue-400', 'ring-purple-400');
            });
        }
        // 三大模式数据
        const modeTemplates = {
            simple: {
                name: '简单模式',
                color: 'green',
                icon: '📝',
                description: '覆盖80%日常需求',
                template: `请帮我[动作]，关于[主题]
要求：[具体一点的要求]`,
                example: `请帮我写一封邮件，关于请假
要求：礼貌、简洁、说明下周一请假看医生`,
                scenarios: [
                    '写邮件、文章、总结',
                    '翻译、解释、回答问题', 
                    '日常对话、简单创作'
                ],
                tips: [
                    '说人话：怎么和同事说就怎么写',
                    '一句话说清楚：主语+动词+宾语',
                    '给一个具体要求就够了'
                ]
            },
            professional: {
                name: '专业模式',
                color: 'blue',
                icon: '💼',
                description: '工作效率翻倍',
                template: `角色：你是[专业角色]
任务：[具体要完成什么]
步骤：
1. [第一步]
2. [第二步] 
3. [检查结果]
要求：[质量要求]`,
                example: `角色：你是资深产品经理
任务：分析这个新功能的可行性
步骤：
1. 评估用户需求强度
2. 分析技术实现难度
3. 预估投入产出比
要求：给出明确的建议（做/不做/改进后再做）`,
                scenarios: [
                    '专业分析、方案设计',
                    '多步骤任务、项目规划',
                    '需要专业视角的工作'
                ],
                tips: [
                    '明确角色：让AI知道以什么身份思考',
                    '分步骤：复杂任务拆解成小步骤',
                    '设标准：明确什么样的结果是好的'
                ]
            },
            smart: {
                name: '智能模式',
                color: 'purple',
                icon: '🤖',
                description: '懒人福音',
                template: `说出你想要什么，剩下的交给我
例如：
- "帮我写个周报"
- "这段代码有bug"
- "给老板写个项目汇报"
系统会自动：
✓ 理解你的需求
✓ 选择最佳模板
✓ 生成优化后的提示词
✓ 直接给出结果`,
                example: `用户输入："帮我写个周报"
智能分析：
- 任务类型：工作文档
- 复杂度：中等
- 推荐模式：专业模式
自动生成：
"你是一名经验丰富的职场人，请帮我写一份工作周报。要求：1）总结本周主要工作内容 2）列出完成的任务和成果 3）提及遇到的问题和解决方案 4）简述下周工作计划。语气专业但不失亲和力，篇幅控制在300-500字。"`,
                scenarios: [
                    '不确定怎么写提示词',
                    '想要最佳效果但不想思考',
                    '快速处理常见任务'
                ],
                tips: [
                    '直接说需求：想要什么就说什么',
                    '相信AI：让它帮你选择最佳方法',
                    '快速迭代：不满意就说"改成xxx样子"'
                ]
            }
        };
        function selectMode(mode) {
            // 重置所有按钮状态
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-green-400', 'ring-blue-400', 'ring-purple-400');
            });
            
            // 高亮选中的模式
            const selectedButton = document.getElementById(mode + 'Mode');
            const colorClass = `ring-${modeTemplates[mode].color}-400`;
            selectedButton.classList.add('ring-2', colorClass);
            
            // 显示模式详情
            showModeDetails(mode);
        }
        function showModeDetails(mode) {
            const modeData = modeTemplates[mode];
            const container = document.getElementById('modeDetails');
            
            container.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                    <div class="flex items-center mb-6">
                        <div class="text-3xl mr-4">${modeData.icon}</div>
                        <div>
                            <h4 class="text-xl font-bold text-gray-900 dark:text-white">${modeData.name}</h4>
                            <p class="text-gray-600 dark:text-gray-400">${modeData.description}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 左侧：模板和示例 -->
                        <div class="space-y-6">
                            <div class="bg-${modeData.color}-50 dark:bg-${modeData.color}-900/20 rounded-lg p-4">
                                <h5 class="font-semibold text-${modeData.color}-900 dark:text-${modeData.color}-300 mb-3">📋 万能模板</h5>
                                <div class="bg-white dark:bg-gray-700 rounded border p-4">
                                    <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${modeData.template}</pre>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="font-semibold text-gray-900 dark:text-white mb-3">🎯 真实例子</h5>
                                <div class="bg-white dark:bg-gray-600 rounded border p-4">
                                    <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${modeData.example}</pre>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右侧：适用场景和技巧 -->
                        <div class="space-y-6">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                                <h5 class="font-semibold text-blue-900 dark:text-blue-300 mb-3">🎪 适用场景</h5>
                                <ul class="space-y-2">
                                    ${modeData.scenarios.map(scenario => `
                                        <li class="flex items-start">
                                            <span class="text-blue-500 mr-2">•</span>
                                            <span class="text-sm text-blue-800 dark:text-blue-200">${scenario}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4">
                                <h5 class="font-semibold text-yellow-900 dark:text-yellow-300 mb-3">💡 实用技巧</h5>
                                <ul class="space-y-2">
                                    ${modeData.tips.map(tip => `
                                        <li class="flex items-start">
                                            <span class="text-yellow-500 mr-2">•</span>
                                            <span class="text-sm text-yellow-800 dark:text-yellow-200">${tip}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <div class="text-center">
                                <button onclick="tryMode('${mode}')" class="px-6 py-3 bg-${modeData.color}-500 text-white rounded-lg hover:bg-${modeData.color}-600 transition-all duration-200 font-medium">
                                    🚀 试试这个模式
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.classList.remove('hidden');
        }
        function tryMode(mode) {
            const modeData = modeTemplates[mode];
            
            // 创建演示区域
            const demo = document.createElement('div');
            demo.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            demo.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center">
                                    <span class="mr-3">${modeData.icon}</span>
                                    ${modeData.name} - 实战演练
                                </h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">按照模板填入你的具体需求</p>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">📝 按模板填写</h4>
                                <textarea placeholder="在这里填入你的具体需求..." 
                                          class="w-full h-64 p-4 text-base bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-${modeData.color}-500 text-gray-900 dark:text-white resize-none"></textarea>
                                <button class="mt-3 w-full px-4 py-2 bg-${modeData.color}-500 text-white rounded-lg hover:bg-${modeData.color}-600 transition-all duration-200">
                                    生成优化后的提示词
                                </button>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">✨ 优化后的提示词</h4>
                                <div class="h-64 p-4 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg">
                                    <div class="text-gray-500 dark:text-gray-400 text-sm text-center pt-20">
                                        填写左侧内容后，这里会显示优化后的提示词
                                    </div>
                                </div>
                                <button class="mt-3 w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200">
                                    复制提示词
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                            <h5 class="font-medium text-blue-900 dark:text-blue-300 mb-2">💡 ${modeData.name}小贴士</h5>
                            <p class="text-sm text-blue-800 dark:text-blue-200">${modeData.tips[0]}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(demo);
        }
        function generateQuickPrompt() {
            const input = document.getElementById('quickInput').value.trim();
            if (!input) {
                showCustomAlert('请先输入你的需求');
                return;
            }
            
            // 显示进度条并开始分析
            showProgressWithSteps('smartProgress', [
                { text: '语义理解分析...', duration: 800 },
                { text: '任务类型识别...', duration: 1000 },
                { text: '模式智能匹配...', duration: 700 },
                { text: '提示词生成...', duration: 1200 },
                { text: '优化完成！', duration: 300 }
            ], () => {
                // 智能分析需求并生成提示词
                const analysis = analyzeUserNeed(input);
                const optimizedPrompt = generateOptimizedPrompt(input, analysis);
                
                // 保存到历史记录
                saveToHistory('smart', input, { analysis, optimizedPrompt });
                
                // 显示结果
                showQuickResult(input, analysis, optimizedPrompt);
                
                // 添加下载按钮
                setTimeout(() => {
                    addDownloadButton('smart', input, { analysis, optimizedPrompt });
                }, 500);
            });
        }
        function analyzeUserNeed(input) {
            const text = input.toLowerCase();
            
            // 任务类型检测
            let taskType = 'general';
            if (text.includes('写') || text.includes('生成') || text.includes('创作')) {
                taskType = 'creation';
            } else if (text.includes('分析') || text.includes('评估') || text.includes('研究')) {
                taskType = 'analysis';
            } else if (text.includes('翻译') || text.includes('解释') || text.includes('说明')) {
                taskType = 'explanation';
            }
            
            // 复杂度评估
            let complexity = 'simple';
            if (text.includes('详细') || text.includes('深入') || text.includes('全面') || text.includes('系统')) {
                complexity = 'professional';
            } else if (text.includes('步骤') || text.includes('流程') || text.includes('方案')) {
                complexity = 'professional';
            }
            
            // 推荐模式
            let recommendedMode = 'simple';
            if (complexity === 'professional' || taskType === 'analysis') {
                recommendedMode = 'professional';
            }
            
            return {
                taskType,
                complexity,
                recommendedMode,
                confidence: 85
            };
        }
        function generateOptimizedPrompt(originalInput, analysis) {
            const { taskType, complexity, recommendedMode } = analysis;
            
            // 基于分析结果生成优化提示词
            let optimized = '';
            
            if (recommendedMode === 'simple') {
                optimized = `请帮我${originalInput}
要求：清晰易懂，直接回答`;
            } else if (recommendedMode === 'professional') {
                if (taskType === 'analysis') {
                    optimized = `你是一位经验丰富的分析专家。
任务：${originalInput}
步骤：
1. 收集和整理相关信息
2. 进行深入分析
3. 得出结论和建议
要求：逻辑清晰，有理有据，提供可行的建议`;
                } else if (taskType === 'creation') {
                    optimized = `你是一位专业的内容创作者。
任务：${originalInput}
要求：
1. 内容原创且有价值
2. 结构清晰，层次分明
3. 语言生动，贴合目标受众
4. 确保内容的准确性和实用性`;
                } else {
                    optimized = `作为专业人士，请${originalInput}
要求：
1. 提供准确且有价值的信息
2. 结构化呈现，便于理解
3. 包含具体的例子或建议
4. 确保内容的实用性`;
                }
            }
            
            return optimized;
        }
        function showQuickResult(original, analysis, optimized) {
            const resultModal = document.createElement('div');
            resultModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            resultModal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center">
                                    <span class="mr-3">🤖</span>
                                    智能优化结果
                                </h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">AI已为您生成优化后的提示词</p>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- 分析结果 -->
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-900 dark:text-blue-300 mb-3">🔍 需求分析</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div class="text-center">
                                        <div class="font-medium text-blue-800 dark:text-blue-200">任务类型</div>
                                        <div class="text-blue-600 dark:text-blue-400">${analysis.taskType === 'creation' ? '创作类' : analysis.taskType === 'analysis' ? '分析类' : '通用类'}</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-medium text-blue-800 dark:text-blue-200">复杂度</div>
                                        <div class="text-blue-600 dark:text-blue-400">${analysis.complexity === 'professional' ? '专业级' : '简单级'}</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-medium text-blue-800 dark:text-blue-200">推荐模式</div>
                                        <div class="text-blue-600 dark:text-blue-400">${modeTemplates[analysis.recommendedMode].name}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 对比展示 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white mb-3">📝 原始需求</h4>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-32">
                                        <div class="text-gray-800 dark:text-gray-200">${original}</div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white mb-3">✨ 优化后的提示词</h4>
                                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 h-32 overflow-y-auto">
                                        <pre class="text-sm text-green-800 dark:text-green-200 whitespace-pre-wrap">${optimized}</pre>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 行动按钮 -->
                            <div class="flex justify-center space-x-4">
                                <button onclick="copyToClipboard('${optimized.replace(/'/g, "\\'")}'); showCustomAlert('提示词已复制到剪贴板！')" 
                                        class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all duration-200">
                                    📋 复制提示词
                                </button>
                                <button onclick="this.closest('.fixed').remove(); showSmartHelper()" 
                                        class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200">
                                    🔄 重新优化
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(resultModal);
        }
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).catch(() => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }
        // ==================== 进度条监测系统 ====================
        function createProgressBar(containerId, moduleName) {
            const container = document.getElementById(containerId) || createProgressContainer(containerId, moduleName);
            
            const progressHTML = `
                <div class="progress-container">
                    <div class="progress-text" id="${containerId}Text">初始化中...</div>
                    <div class="progress-bar progress-normal" id="${containerId}Bar" style="width: 0%">
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-500 dark:text-gray-400" id="${containerId}Status">
                    🔄 正在启动${moduleName}...
                </div>
            `;
            
            container.innerHTML = progressHTML;
            return container;
        }
        function createProgressContainer(containerId, moduleName) {
            const container = document.createElement('div');
            container.id = containerId;
            container.className = 'bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6';
            container.innerHTML = `
                <h4 class="font-semibold text-blue-900 dark:text-blue-300 mb-3 flex items-center">
                    <span class="mr-2">📊</span>
                    ${moduleName}进度监测
                </h4>
            `;
            
            // 插入到对应模态框的内容区域
            if (containerId.includes('analyzer')) {
                document.querySelector('#analyzerModal .grid').insertBefore(container, document.querySelector('#analyzerModal .grid').firstChild);
            } else if (containerId.includes('smart')) {
                document.querySelector('#smartHelperModal .p-6').appendChild(container);
            } else if (containerId.includes('trinity')) {
                document.querySelector('#trinityModal .p-6').appendChild(container);
            }
            
            return container;
        }
        function updateProgress(containerId, percentage, text, status = 'normal') {
            const progressBar = document.getElementById(containerId + 'Bar');
            const progressText = document.getElementById(containerId + 'Text');
            const statusText = document.getElementById(containerId + 'Status');
            
            if (!progressBar || !progressText || !statusText) return;
            
            // 更新进度条样式
            progressBar.className = `progress-bar progress-${status}`;
            progressBar.style.width = percentage + '%';
            
            // 更新文本
            progressText.textContent = text;
            
            // 更新状态图标和描述
            const statusIcons = {
                normal: '🔄',
                warning: '⚠️',
                error: '❌',
                complete: '✅'
            };
            
            const statusMessages = {
                normal: '正在处理中...',
                warning: '检测到异常，正在处理...',
                error: '处理失败，请重试',
                complete: '处理完成！'
            };
            
            statusText.innerHTML = `${statusIcons[status]} ${statusMessages[status]}`;
            
            // 错误状态时添加重试按钮
            if (status === 'error') {
                statusText.innerHTML += ` <button onclick="retryProcess('${containerId}')" class="ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">重试</button>`;
            }
        }
        function showProgressWithSteps(containerId, steps, onComplete) {
            const moduleName = containerId.includes('analyzer') ? '配方解析器' : 
                              containerId.includes('smart') ? '智能助手' : '三维思维生成器';
            
            createProgressBar(containerId, moduleName);
            
            let currentStep = 0;
            const totalSteps = steps.length;
            
            function executeNextStep() {
                if (currentStep >= totalSteps) {
                    updateProgress(containerId, 100, '处理完成！', 'complete');
                    setTimeout(() => {
                        document.getElementById(containerId)?.remove();
                        onComplete();
                    }, 1000);
                    return;
                }
                
                const step = steps[currentStep];
                const percentage = ((currentStep + 1) / totalSteps) * 100;
                
                updateProgress(containerId, percentage, step.text, 'normal');
                
                // 模拟异常检测（5%概率）
                const hasError = Math.random() < 0.05;
                if (hasError && currentStep > 0) {
                    setTimeout(() => {
                        updateProgress(containerId, percentage, '检测到异常', 'warning');
                        setTimeout(() => {
                            updateProgress(containerId, percentage, '异常已修复，继续处理', 'normal');
                            currentStep++;
                            setTimeout(executeNextStep, 500);
                        }, 1000);
                    }, step.duration / 2);
                } else {
                    setTimeout(() => {
                        currentStep++;
                        executeNextStep();
                    }, step.duration);
                }
            }
            
            executeNextStep();
        }
        function retryProcess(containerId) {
            if (containerId.includes('analyzer')) {
                analyzePrompt();
            } else if (containerId.includes('smart')) {
                generateQuickPrompt();
            } else if (containerId.includes('trinity')) {
                startTrinityGeneration();
            }
        }
        // ==================== 下载功能系统 ====================
        function generateFileName(moduleType, timestamp = new Date()) {
            const dateStr = timestamp.toISOString().slice(0, 10);
            const timeStr = timestamp.toTimeString().slice(0, 8).replace(/:/g, '-');
            
            const moduleNames = {
                analyzer: '提示词配方解析',
                smart: '智能助手生成',
                trinity: '三维思维协作'
            };
            
            return `${moduleNames[moduleType]}_${dateStr}_${timeStr}`;
        }
        function addDownloadButton(moduleType, originalData, analysisData) {
            const moduleContainers = {
                analyzer: '#optimizationSuggestions',
                smart: '.flex.justify-center.space-x-4',
                trinity: '.flex.justify-center.space-x-4'
            };
            
            const container = document.querySelector(moduleContainers[moduleType]);
            if (!container) return;
            
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200 flex items-center';
            downloadBtn.innerHTML = `
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                下载报告
            `;
            
            downloadBtn.onclick = () => downloadReport(moduleType, originalData, analysisData);
            
            if (moduleType === 'analyzer') {
                container.appendChild(downloadBtn);
            } else {
                container.appendChild(downloadBtn);
            }
        }
        function downloadReport(moduleType, originalData, analysisData) {
            const fileName = generateFileName(moduleType);
            
            let reportContent = '';
            
            switch (moduleType) {
                case 'analyzer':
                    reportContent = generateAnalyzerReport(originalData, analysisData);
                    break;
                case 'smart':
                    reportContent = generateSmartHelperReport(originalData, analysisData);
                    break;
                case 'trinity':
                    reportContent = generateTrinityReport(originalData, analysisData);
                    break;
            }
            
            // 创建并下载文件
            const blob = new Blob([reportContent], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName + '.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showCustomAlert(`报告已下载：${fileName}.md`);
        }
        function generateAnalyzerReport(originalPrompt, analysis) {
            const timestamp = new Date().toLocaleString('zh-CN');
            
            return `# 提示词配方解析报告
## 📋 基本信息
- **生成时间**: ${timestamp}
- **原始提示词长度**: ${analysis.promptLength} 字符
- **复杂度等级**: ${analysis.complexity} 个操作方法
- **涉及分类**: ${analysis.categories.length} 个主要分类
## 📝 原始提示词
\`\`\`
${originalPrompt}
\`\`\`
## 🧬 配方成分分析
### 识别到的操作方法
${analysis.identifiedMethods.map((method, index) => `
${index + 1}. **${method.method}** (${method.category})
   - 置信度: ${method.confidence}%
   - 证据: ${method.evidence}
`).join('')}
### 各分类分布
${analysis.categories.map(category => `
- **${category}**: ${analysis.identifiedMethods.filter(m => m.category === category).length} 个方法
`).join('')}
## 📊 效果评估
### 综合质量评分: ${analysis.strengthScore.total}/100
### 详细评分分解
${Object.entries(analysis.strengthScore.breakdown).map(([item, score]) => `
- **${item}**: ${score} 分
`).join('')}
### 评估等级
${analysis.strengthScore.total >= 80 ? '🟢 优秀' : 
  analysis.strengthScore.total >= 60 ? '🟡 良好' : 
  analysis.strengthScore.total >= 40 ? '🟠 一般' : '🔴 需改进'}
## 💡 优化建议
### 缺失的操作类别
${Object.keys(methodsDatabase).filter(cat => !analysis.categories.includes(cat)).map(cat => `
- **${cat}**: ${methodsDatabase[cat].description}
`).join('') || '无明显缺失'}
### 改进方向
1. **提升结构化程度**: 可以考虑添加更明确的步骤分解
2. **增强约束条件**: 明确禁止事项和质量标准
3. **丰富上下文信息**: 提供更多背景和场景信息
## 📈 扩展建议
### 举一反三的可能性
- 可以尝试将当前方法应用到其他领域
- 考虑结合多个操作类别形成组合方法
- 探索从不同角度重新定义问题本质
---
*本报告由提示词配方解析器自动生成*`;
        }
        function generateSmartHelperReport(originalInput, analysisResult) {
            const timestamp = new Date().toLocaleString('zh-CN');
            
            return `# 智能提示词助手生成报告
## 📋 基本信息
- **生成时间**: ${timestamp}
- **原始需求**: ${originalInput}
- **任务类型**: ${analysisResult.taskType}
- **复杂度**: ${analysisResult.complexity}
- **推荐模式**: ${analysisResult.recommendedMode}
## 🎯 需求分析
### 自动检测结果
- **任务类别**: ${analysisResult.taskType === 'creation' ? '创作类' : 
                   analysisResult.taskType === 'analysis' ? '分析类' : '通用类'}
- **复杂程度**: ${analysisResult.complexity === 'professional' ? '专业级' : '简单级'}
- **置信度**: ${analysisResult.confidence}%
### 推荐理由
基于对输入内容的语义分析，系统识别出这是一个${analysisResult.taskType}类型的任务，
复杂度为${analysisResult.complexity}级别，因此推荐使用${analysisResult.recommendedMode}模式。
## 📝 生成的提示词
\`\`\`
${generateOptimizedPrompt(originalInput, analysisResult)}
\`\`\`
## 🎓 模式说明
### ${modeTemplates[analysisResult.recommendedMode].name}特点
- **适用场景**: ${modeTemplates[analysisResult.recommendedMode].scenarios.join('、')}
- **核心理念**: ${modeTemplates[analysisResult.recommendedMode].tips[0]}
### 使用建议
${modeTemplates[analysisResult.recommendedMode].tips.map((tip, index) => `
${index + 1}. ${tip}
`).join('')}
## 💡 进阶优化
### 如果效果不理想
1. **调整具体要求**: 更明确地描述期望的输出格式
2. **增加约束条件**: 明确什么不要做
3. **提供更多背景**: 补充相关的上下文信息
4. **尝试其他模式**: 根据实际效果调整复杂度
### 组合使用建议
- 可以将多个简单提示词组合成复杂流程
- 考虑分步骤执行，每步确认后再继续
- 根据反馈结果迭代优化提示词
---
*本报告由智能提示词助手自动生成*`;
        }
        function generateTrinityReport(taskInput, analysisResult) {
            const timestamp = new Date().toLocaleString('zh-CN');
            
            return `# 三维思维协作生成报告
## 📋 基本信息
- **生成时间**: ${timestamp}
- **原始任务**: ${taskInput}
- **任务类型**: ${analysisResult.taskType}
- **主要思维**: ${analysisResult.primaryFocus}
- **协作模式**: ${document.getElementById('collaborationMode').value}
## 🧠 三维思维配置
### 权重分配
- **🏗️ 结构思维**: ${document.getElementById('structureWeight').value}%
- **💥 解构思维**: ${document.getElementById('deconstructWeight').value}%
- **🔗 整合思维**: ${document.getElementById('integrateWeight').value}%
### 协作模式
- **模式**: ${document.getElementById('collaborationMode').value === 'sequential' ? '顺序协作' : 
              document.getElementById('collaborationMode').value === 'parallel' ? '并行协作' : '迭代协作'}
- **输出深度**: ${document.getElementById('outputDepth').value === 'outline' ? '框架概要' : 
                   document.getElementById('outputDepth').value === 'detailed' ? '详细分析' : '全面深入'}
## 🎯 任务分析
### 智能识别结果
- **任务特征**: ${analysisResult.taskType}类任务
- **建议权重**: ${analysisResult.primaryFocus}思维主导
- **推荐顺序**: ${analysisResult.suggestedPersonas.join(' → ')}
### 三维思维应用
#### 🏗️ 结构思维贡献
${trinityPersonas.structure.thinking[analysisResult.taskType]}
**应用方法**:
${trinityPersonas.structure.methods.map(method => `- ${method}`).join('\n')}
#### 💥 解构思维贡献
${trinityPersonas.deconstruct.thinking[analysisResult.taskType]}
**应用方法**:
${trinityPersonas.deconstruct.methods.map(method => `- ${method}`).join('\n')}
#### 🔗 整合思维贡献
${trinityPersonas.integrate.thinking[analysisResult.taskType]}
**应用方法**:
${trinityPersonas.integrate.methods.map(method => `- ${method}`).join('\n')}
## ✨ 最终生成的提示词
\`\`\`
${document.querySelector('#generatedPrompt pre')?.textContent || '提示词生成中...'}
\`\`\`
## 🔄 协作过程记录
### 协作轨迹
根据${document.getElementById('collaborationMode').value}模式，三个思维维度按照以下方式进行协作：
1. **启动阶段**: 任务分析和思维调度
2. **协作阶段**: 多维度并行/顺序/迭代处理
3. **整合阶段**: 统一输出和质量检验
### 效果验证
- **逻辑严密性**: 结构思维确保
- **创新突破性**: 解构思维贡献
- **表达清晰性**: 整合思维保障
## 💡 使用建议
### 最佳应用场景
- 复杂决策分析
- 创新方案设计
- 多角度问题解决
- 战略规划制定
### 进阶技巧
1. **权重调优**: 根据任务特点调整三维权重
2. **模式切换**: 不同阶段使用不同协作模式
3. **迭代优化**: 基于输出效果微调配置
4. **组合应用**: 与其他提示词方法结合使用
---
*本报告由三维思维生成器自动生成*`;
        }
        // 三维思维生成器相关函数
        function showTrinityGenerator() {
            document.getElementById('trinityModal').classList.remove('hidden');
        }
        function closeTrinityGenerator() {
            document.getElementById('trinityModal').classList.add('hidden');
            document.getElementById('trinityProcess').classList.add('hidden');
            document.getElementById('finalPrompt').classList.add('hidden');
            // 重置表单
            document.getElementById('trinityTaskInput').value = '';
            document.querySelectorAll('.task-tag').forEach(tag => {
                tag.classList.remove('bg-purple-500', 'text-white');
                tag.classList.add('bg-gray-100', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
            });
        }
        let selectedTags = [];
        function toggleTaskTag(tagType) {
            const tagElement = document.getElementById(`tag-${tagType}`);
            
            if (selectedTags.includes(tagType)) {
                // 取消选择
                selectedTags = selectedTags.filter(t => t !== tagType);
                tagElement.classList.remove('bg-purple-500', 'text-white');
                tagElement.classList.add('bg-gray-100', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
            } else {
                // 选择
                selectedTags.push(tagType);
                tagElement.classList.remove('bg-gray-100', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
                tagElement.classList.add('bg-purple-500', 'text-white');
            }
        }
        function updateWeights() {
            const structure = document.getElementById('structureWeight').value;
            const deconstruct = document.getElementById('deconstructWeight').value;
            const integrate = document.getElementById('integrateWeight').value;
            
            // 更新显示
            document.getElementById('structureValue').textContent = structure + '%';
            document.getElementById('deconstructValue').textContent = deconstruct + '%';
            document.getElementById('integrateValue').textContent = integrate + '%';
            
            // 确保总和为100%（可选：自动调整）
            const total = parseInt(structure) + parseInt(deconstruct) + parseInt(integrate);
            if (total !== 100) {
                // 可以在这里添加警告或自动调整逻辑
            }
        }
        // 三维思维协作核心逻辑
        const trinityPersonas = {
            structure: {
                name: '结构思维',
                icon: '🏗️',
                color: 'purple',
                description: '逻辑结构化，系统性分析，层级化组织',
                thinking: {
                    creative: '建立创新的系统框架',
                    analytical: '构建严密的分析结构',
                    strategic: '设计分层的战略体系',
                    complex: '分解复杂问题为可管理的模块'
                },
                methods: [
                    '层级分解：将复杂任务分解为可执行的子任务',
                    '框架搭建：使用MECE原则建立分析框架',
                    '逻辑链条：建立清晰的因果关系链',
                    '系统建模：将问题抽象为系统模型'
                ]
            },
            deconstruct: {
                name: '解构思维',
                icon: '💥',
                color: 'pink',
                description: '打破常规，反向思考，创新突破',
                thinking: {
                    creative: '颠覆传统创意模式',
                    analytical: '质疑分析的基本假设',
                    strategic: '挑战战略的根本前提',
                    complex: '从反向角度重新定义问题'
                },
                methods: [
                    '假设挑战：质疑所有看似合理的假设',
                    '反向思考：从结果倒推可能的路径',
                    '边界打破：突破传统的思维限制',
                    '概念重构：重新定义核心概念'
                ]
            },
            integrate: {
                name: '整合思维',
                icon: '🔗',
                color: 'orange',
                description: '融合表达，平衡协调，清晰呈现',
                thinking: {
                    creative: '将创新想法转化为可行方案',
                    analytical: '整合分析结果形成完整结论',
                    strategic: '平衡各种战略要素',
                    complex: '将复杂分析综合为简明建议'
                },
                methods: [
                    '矛盾调和：平衡对立观点找到中间道路',
                    '层次整合：将不同层次的信息有机结合',
                    '语言转换：将专业分析转化为易懂表达',
                    '价值综合：综合考虑各方利益得出最优解'
                ]
            }
        };
        function startTrinityGeneration() {
            const taskInput = document.getElementById('trinityTaskInput').value.trim();
            if (!taskInput) {
                showCustomAlert('请先输入任务需求');
                return;
            }
            // 获取配置
            const structureWeight = parseInt(document.getElementById('structureWeight').value);
            const deconstructWeight = parseInt(document.getElementById('deconstructWeight').value);
            const integrateWeight = parseInt(document.getElementById('integrateWeight').value);
            const collaborationMode = document.getElementById('collaborationMode').value;
            const outputDepth = document.getElementById('outputDepth').value;
            // 显示协作过程
            document.getElementById('trinityProcess').classList.remove('hidden');
            
            // 开始协作流程
            executeTrinitCollaboration(taskInput, {
                weights: { structure: structureWeight, deconstruct: deconstructWeight, integrate: integrateWeight },
                mode: collaborationMode,
                depth: outputDepth,
                tags: selectedTags
            });
        }
        function executeTrinitCollaboration(taskInput, config) {
            const processContainer = document.getElementById('processSteps');
            processContainer.innerHTML = '';
            // 任务分析
            const taskAnalysis = analyzeTrinityTask(taskInput, config.tags);
            
            if (config.mode === 'sequential') {
                executeSequentialMode(taskInput, taskAnalysis, config, processContainer);
            } else if (config.mode === 'parallel') {
                executeParallelMode(taskInput, taskAnalysis, config, processContainer);
            } else if (config.mode === 'iterative') {
                executeIterativeMode(taskInput, taskAnalysis, config, processContainer);
            }
        }
        function analyzeTrinityTask(taskInput, tags) {
            const analysis = {
                taskType: 'general',
                complexity: 'medium',
                primaryFocus: 'structure',
                keywords: [],
                suggestedPersonas: []
            };
            const text = taskInput.toLowerCase();
            // 分析任务类型
            if (tags.includes('creative') || text.includes('创新') || text.includes('设计')) {
                analysis.taskType = 'creative';
                analysis.primaryFocus = 'deconstruct';
            } else if (tags.includes('analytical') || text.includes('分析') || text.includes('评估')) {
                analysis.taskType = 'analytical';
                analysis.primaryFocus = 'structure';
            } else if (tags.includes('strategic') || text.includes('策略') || text.includes('规划')) {
                analysis.taskType = 'strategic';
                analysis.primaryFocus = 'integrate';
            } else if (tags.includes('complex') || text.includes('复杂') || text.includes('系统')) {
                analysis.taskType = 'complex';
                analysis.primaryFocus = 'structure';
            }
            // 建议人格组合
            switch (analysis.taskType) {
                case 'creative':
                    analysis.suggestedPersonas = ['deconstruct', 'integrate', 'structure'];
                    break;
                case 'analytical':
                    analysis.suggestedPersonas = ['structure', 'deconstruct', 'integrate'];
                    break;
                case 'strategic':
                    analysis.suggestedPersonas = ['integrate', 'structure', 'deconstruct'];
                    break;
                case 'complex':
                    analysis.suggestedPersonas = ['structure', 'integrate', 'deconstruct'];
                    break;
                default:
                    analysis.suggestedPersonas = ['structure', 'deconstruct', 'integrate'];
            }
            return analysis;
        }
        function executeSequentialMode(taskInput, taskAnalysis, config, container) {
            const personas = taskAnalysis.suggestedPersonas;
            let currentStep = 0;
            function processNextPersona() {
                if (currentStep >= personas.length) {
                    // 协作完成，生成最终提示词
                    generateFinalTrinityPrompt(taskInput, taskAnalysis, config);
                    return;
                }
                const personaType = personas[currentStep];
                const persona = trinityPersonas[personaType];
                
                const stepElement = document.createElement('div');
                stepElement.className = 'bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-' + persona.color + '-500';
                stepElement.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${persona.icon}</span>
                            <div>
                                <h5 class="font-semibold text-gray-900 dark:text-white">第${currentStep + 1}步：${persona.name}分析</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${persona.description}</p>
                            </div>
                        </div>
                        <div class="processing-indicator">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-${persona.color}-500"></div>
                        </div>
                    </div>
                    <div class="thinking-content hidden">
                        <div class="bg-${persona.color}-50 dark:bg-${persona.color}-900/20 rounded-lg p-3 mb-3">
                            <h6 class="font-medium text-${persona.color}-900 dark:text-${persona.color}-300 mb-2">💭 思考重点</h6>
                            <p class="text-sm text-${persona.color}-800 dark:text-${persona.color}-200">${persona.thinking[taskAnalysis.taskType]}</p>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">🔧 应用方法</h6>
                            <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
                                ${persona.methods.map(method => `<li>• ${method}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                
                container.appendChild(stepElement);
                // 模拟思考过程
                setTimeout(() => {
                    stepElement.querySelector('.processing-indicator').classList.add('hidden');
                    stepElement.querySelector('.thinking-content').classList.remove('hidden');
                    
                    currentStep++;
                    setTimeout(processNextPersona, 1500);
                }, 2000);
            }
            processNextPersona();
        }
        function executeParallelMode(taskInput, taskAnalysis, config, container) {
            const personas = Object.keys(trinityPersonas);
            
            // 同时显示所有人格的思考过程
            personas.forEach((personaType, index) => {
                const persona = trinityPersonas[personaType];
                const weight = config.weights[personaType];
                
                const stepElement = document.createElement('div');
                stepElement.className = `bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-${persona.color}-500 opacity-0 transform translate-y-4`;
                stepElement.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${persona.icon}</span>
                            <div>
                                <h5 class="font-semibold text-gray-900 dark:text-white">${persona.name}（权重: ${weight}%）</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${persona.description}</p>
                            </div>
                        </div>
                        <div class="processing-indicator">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-${persona.color}-500"></div>
                        </div>
                    </div>
                    <div class="thinking-content hidden">
                        <div class="bg-${persona.color}-50 dark:bg-${persona.color}-900/20 rounded-lg p-3 mb-3">
                            <h6 class="font-medium text-${persona.color}-900 dark:text-${persona.color}-300 mb-2">💭 思考角度</h6>
                            <p class="text-sm text-${persona.color}-800 dark:text-${persona.color}-200">${persona.thinking[taskAnalysis.taskType]}</p>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">⚡ 并行处理</h6>
                            <p class="text-sm text-gray-700 dark:text-gray-300">正在同步处理任务的${persona.name}维度...</p>
                        </div>
                    </div>
                `;
                
                container.appendChild(stepElement);
                // 动画显示
                setTimeout(() => {
                    stepElement.classList.remove('opacity-0', 'transform', 'translate-y-4');
                    stepElement.classList.add('transition-all', 'duration-500');
                }, index * 300);
                // 模拟思考过程
                setTimeout(() => {
                    stepElement.querySelector('.processing-indicator').classList.add('hidden');
                    stepElement.querySelector('.thinking-content').classList.remove('hidden');
                }, 2000 + index * 500);
            });
            // 等待所有人格完成思考后生成最终结果
            setTimeout(() => {
                generateFinalTrinityPrompt(taskInput, taskAnalysis, config);
            }, 5000);
        }
        function executeIterativeMode(taskInput, taskAnalysis, config, container) {
            const iterations = 2;
            let currentIteration = 0;
            function nextIteration() {
                if (currentIteration >= iterations) {
                    generateFinalTrinityPrompt(taskInput, taskAnalysis, config);
                    return;
                }
                const iterationElement = document.createElement('div');
                iterationElement.className = 'mb-6';
                iterationElement.innerHTML = `
                    <div class="bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-4 mb-4">
                        <h5 class="font-semibold text-indigo-900 dark:text-indigo-300 mb-2">🔁 第${currentIteration + 1}轮迭代</h5>
                        <p class="text-sm text-indigo-800 dark:text-indigo-200">三维思维协作中...</p>
                    </div>
                    <div class="iteration-content space-y-3"></div>
                `;
                
                container.appendChild(iterationElement);
                const iterationContent = iterationElement.querySelector('.iteration-content');
                // 依次执行三个人格的思考
                Object.keys(trinityPersonas).forEach((personaType, index) => {
                    const persona = trinityPersonas[personaType];
                    
                    setTimeout(() => {
                        const personaStep = document.createElement('div');
                        personaStep.className = `bg-white dark:bg-gray-800 rounded-lg p-3 border border-${persona.color}-200 dark:border-${persona.color}-700`;
                        personaStep.innerHTML = `
                            <div class="flex items-center mb-2">
                                <span class="text-lg mr-2">${persona.icon}</span>
                                <span class="font-medium text-gray-900 dark:text-white">${persona.name}</span>
                                <span class="ml-auto text-xs text-gray-500">迭代优化中...</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${persona.thinking[taskAnalysis.taskType]}</p>
                        `;
                        
                        iterationContent.appendChild(personaStep);
                    }, index * 800);
                });
                currentIteration++;
                setTimeout(nextIteration, 3000);
            }
            nextIteration();
        }
        function generateFinalTrinityPrompt(taskInput, taskAnalysis, config) {
            // 基于三维思维协作生成最终提示词
            const { weights, depth, tags } = config;
            
            let prompt = '';
            // 根据权重决定提示词的主要结构
            const dominantPersona = Object.keys(weights).reduce((a, b) => weights[a] > weights[b] ? a : b);
            
            // 构建提示词
            if (dominantPersona === 'structure') {
                prompt = buildStructureDominantPrompt(taskInput, taskAnalysis, config);
            } else if (dominantPersona === 'deconstruct') {
                prompt = buildDeconstructDominantPrompt(taskInput, taskAnalysis, config);
            } else {
                prompt = buildIntegrateDominantPrompt(taskInput, taskAnalysis, config);
            }
            // 显示最终结果
            displayFinalTrinityPrompt(prompt, taskAnalysis, config);
        }
        function buildStructureDominantPrompt(taskInput, taskAnalysis, config) {
            const depthInstructions = {
                outline: '提供清晰的框架概要',
                detailed: '进行详细的分析和说明',
                comprehensive: '提供全面深入的分析'
            };
            return `# 系统性分析师
## 角色定位
你是一位擅长结构化思维的资深分析师，具备将复杂问题拆解为清晰层次的能力。
## 核心任务
${taskInput}
## 分析框架
请按照以下结构化方法进行分析：
### 第一层：问题拆解
- 将主要问题分解为3-5个核心子问题
- 建立问题之间的逻辑关系
- 确定分析的优先级顺序
### 第二层：深度分析
- 对每个子问题进行系统性分析
- 使用MECE原则确保分析的完整性
- 提供数据支撑和逻辑推理
### 第三层：解决方案
- 基于分析结果设计解决方案
- 确保方案的可操作性和可衡量性
- 提供实施的时间表和里程碑
## 思维要求
- **批判性思考**：质疑假设，验证逻辑
- **创新突破**：在结构化基础上寻求创新点
- **整体整合**：确保各部分协调统一
## 输出要求
- ${depthInstructions[config.depth]}
- 使用清晰的标题和编号结构
- 每个要点都要有具体的执行建议
- 最终给出优先级排序和行动计划
## 质量标准
确保分析具备逻辑严密性、实用可操作性、创新突破性的特点。`;
        }
        function buildDeconstructDominantPrompt(taskInput, taskAnalysis, config) {
            return `# 创新解构思维师
## 角色设定
你是一位善于打破常规思维的创新分析师，专长于从反向角度重新定义问题本质。
## 挑战任务
${taskInput}
## 解构方法论
采用以下颠覆性思维模式：
### 🔥 假设挑战
- 列出所有看似理所当然的假设
- 逐一质疑这些假设的合理性
- 探索假设不成立时的可能性
### 💥 反向思考
- 从完全相反的角度审视问题
- 考虑"不做这件事"的可能收益
- 寻找传统方法的盲点和局限
### 🌪️ 边界突破
- 跳出行业、领域、时间的限制
- 引入跨界的新视角和新方法
- 重新定义问题的核心概念
## 创新融合
在解构的基础上：
- **结构化整理**：将创新想法系统化
- **现实性检验**：评估可行性和风险
- **优化整合**：形成可执行的创新方案
## 输出特色
- 提供至少3个颠覆性的新视角
- 每个视角都要有具体的论证和例证
- 平衡创新性与可操作性
- 给出"安全创新"和"激进创新"两套方案
## 思维警示
避免为了创新而创新，确保解构后的方案能够真正解决问题。`;
        }
        function buildIntegrateDominantPrompt(taskInput, taskAnalysis, config) {
            return `# 整合协调专家
## 专家身份
你是一位善于平衡各方观点、整合复杂信息的协调型专家，具备将多元化观点融合为统一方案的能力。
## 整合使命
${taskInput}
## 多维整合框架
### 🎯 观点收集
- 系统性分析：构建逻辑严密的分析框架
- 创新性思考：引入突破性的新视角
- 平衡性考量：兼顾各方利益和约束
### 🔗 矛盾调和
- 识别不同观点间的冲突点
- 寻找各方观点的共同基础
- 设计兼容性解决方案
### ⚖️ 价值平衡
- 短期效益 vs 长期价值
- 理想方案 vs 现实约束
- 创新突破 vs 风险控制
### 🌟 方案优化
- 整合最佳要素形成混合方案
- 设计分阶段实施策略
- 建立反馈优化机制
## 整合原则
- **包容性**：充分考虑所有相关观点
- **平衡性**：避免极端化的单一方案
- **实用性**：确保方案的可执行性
- **适应性**：保持方案的灵活调整空间
## 最终输出
- 提供一个平衡各方需求的核心方案
- 给出2-3个备选调整方案
- 详细说明方案的平衡点和权衡考量
- 设计实施过程中的协调机制
注重在创新与稳健、理想与现实之间找到最佳平衡点。`;
        }
        function displayFinalTrinityPrompt(prompt, taskAnalysis, config) {
            const container = document.getElementById('generatedPrompt');
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between mb-4">
                        <h5 class="font-semibold text-gray-900 dark:text-white">基于三维思维协作生成</h5>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs rounded">🏗️ ${config.weights.structure}%</span>
                            <span class="px-2 py-1 bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300 text-xs rounded">💥 ${config.weights.deconstruct}%</span>
                            <span class="px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 text-xs rounded">🔗 ${config.weights.integrate}%</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 max-h-96 overflow-y-auto">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap leading-relaxed">${prompt}</pre>
                    </div>
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                        <div class="text-xs text-blue-700 dark:text-blue-300">
                            <strong>协作模式：</strong>${config.mode === 'sequential' ? '顺序协作' : config.mode === 'parallel' ? '并行协作' : '迭代协作'} | 
                            <strong>输出深度：</strong>${config.depth === 'outline' ? '框架概要' : config.depth === 'detailed' ? '详细分析' : '全面深入'} | 
                            <strong>任务类型：</strong>${taskAnalysis.taskType}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('finalPrompt').classList.remove('hidden');
        }
        function copyTrinityPrompt() {
            const promptText = document.querySelector('#generatedPrompt pre').textContent;
            copyToClipboard(promptText);
            showCustomAlert('三维协作提示词已复制到剪贴板！');
        }
        function optimizeTrinityPrompt() {
            // 重新启动协作过程
            document.getElementById('trinityProcess').classList.add('hidden');
            document.getElementById('finalPrompt').classList.add('hidden');
            
            setTimeout(() => {
                startTrinityGeneration();
            }, 500);
        }
    </script>
</body>
</html>
